<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
   "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<meta content="text/html;charset=ISO-8859-1" http-equiv="Content-Type">
	<title>SOMO HPLC-SAXS Module</title>
	<link href="mainstyle2.css" rel="styleSheet" type="text/css">
</head>
<body>
<table BORDER=0 CELLPADDING=5 >
<tr>
<td><img SRC="USSOMO-banner.png" BORDER="0" ALT="UltraScan Version"> </td>
<td>
<center>
<h1>
<i>Manual</i></h1></center>
</td>
</tr>
</table>

<hr>
<center>
<h2>
SOMO HPLC-SAXS Module:</h2></center>
<h3><center>Last updated: June 2022 </center></h3><p>

<center><span style="color:#CC0000">NOTICE: this module is being developed by E. Brookes, J. P&eacute;rez, P. Vachette, and M. Rocco.<br>
Portions of this help file are taken from the Supplementary Materials of Brookes et al., "Fibrinogen species as resolved by HPLC-SAXS data processing within the UltraScan SOlution MOdeler (US-SOMO) enhanced SAS module", J. Appl. Cryst. 46:1823-1833 (2013), and from Brookes et al. "US-SOMO HPLC-SAXS Module: Dealing with Capillary Fouling, and Extraction of Pure Component Patterns from Poorly Resolved SEC-SAXS Data", J. Appl. Cryst. 49:1827-1841, 2016. Some recent improvements are discussed in Brookes and Rocco, Eur. Biophys. J., 2018, submitted </span>
</center>

<p><center>
<img SRC="somo-HPLC-SAXS_3.png" ALT="SOMO HPLC-SAXS Lysozyme I(q) data">
</center>
<p>
This <b>US-SOMO</b> module was conceived for the analysis of HPLC-SAXS data. In the image above, the main panel of the <b><i>HPLC-SAXS</i></b> module is shown. The buttons with the black labels are the ones currently active, the ones with the red labels become active when allowed by the processing/visualization stage. The graphics panel shows a collection of HPLC-SAXS log<sub>10</sub>[<i>I(q)</i>] vs. <i>q</i> SAXS data frames (points with 0 or negative values are automatically omitted from the visualization only) for a chicken egg-white lysozyme chromatographic separation   on a Agilent BioSec-3 (3 &mu;m particle size, 300 &Aring; pore-size) 4.6&nbsp;&times;&nbsp;300&nbsp;mm column, eluted with Hepes 50&nbsp;mM, NaCl&nbsp;100 mM, pH&nbsp;7. Note the permanent upturn at very small <i>q</i>-values, due to biological material aggregated by the intense X-ray beam on the capillary cell walls under these far from optimal experimental conditions. While this kind of problem should be (and has been) preferentially dealt with at the experimental level, we use this dataset to demonstrate the potential for correcting data still presenting such an issue.<p>

The left side of the window is divided in three sections, labeled "<b><i>Data files</i></b>", "<b><i>Produced Data</i></b>", and "<b><i>Messages</i></b>". By clicking on these labels, the corresponding panel below each label will disappear, allowing for an expansion of the remaining other panel(s). If every panel is made to disappear, the main graph will expand to cover the full size of the <b><i>HPLC-SAXS</i></b> window. By clicking again of the labels, the corresponding panels will be restored.<p>

On the top left panel (<b><i>Data files</i></b>) there are four buttons:<p>

    The <b><i>Add files</i></b> button is used to load data into the module. An operating directory can be pre-selected by clicking on the path shown above it, and navigating in the file system (selecting the <i>Lock</i> checkbox will fix that directory). The file format for SAXS data recognized by the <b>US-SOMO</b> <b><i>HPLC-SAXS</i></b> module consist of .dat files with two or three TAB- or space-separated columns containing the <i>q</i>, <i>I(q)</i>, and optionally their associated standard deviation (SD) values, respectively. Each frame number (or time value) must be present somewhere in the filename with a common prefix and suffix. For example, data1saxs.dat, data2saxs.dat, data3saxs.dat will be recognized as frames 1,2,3, where "data" and "saxs" can be replaced by any common sequence of characters. Consequently, 1.dat, 2.dat, 3.dat would be acceptable, but abc1.dat, qrs2.dat, xyz3.dat would not, because the prefix characters are not common. Furthermore, the loader will also arrange the data files sequentially, in increasing frame number (or time value) order. Concentration-related data should be instead uploaded using the <b><i>Concentration load</i></b> button (see below). <i>I(q)</i> vs. <i>q</i> and concentration data frames are automatically recognized and the labels on the <i>x</i>- and <i>y</i>-axes are then properly set.<p></p>
    Note that when loading <i>I(q)</i> data files containing <i>q</i> values, they are expected to be in units of 1/Angstrom or 1/nm units. If the 1st line of the data file contains the text <i>Units:1/A</i> or <i>Units:1/nm</i>, it will be automatically loaded in the proper format.  Otherwise, it is controlled by the setting of the <a href=somo_saxs_options.html#sasmiscellaneous>SAS Miscellanous Options</a>, in particular, the <i><b>I(q) curves in 1/angstrom</b></i> and the <i><b>I(q) curves in 1/nanometer</b></i> mutually exclusive checkboxes.  All 1/nm data will be converted into 1/Angstrom data upon loading. Files saved will be written with the <i>Units:1/A</i> header text automatically.
    <p></p>

<b><i>Similar</i></b> will select files with similar names and allow manual pattern matching entry if no new similar files are selected.<p> 

<b><i>Concentration</i></b> will show every file listed together with their associated concentration (mg/ml), if appropriate and properly set (see below). Concentrations can also be entered and modified manually. They can be used to normalize the <i>I(q)</i> vs. <i>q</i> data (see below). Loaded files can be displayed on the graphics panel by individually clicking on them (shift-click will select a contiguous series, ctrl-click allows multiple irregularly spaced selections). Produced data will also show up in this panel with associated putative filenames.<p> 

<b><i>Remove files</i></b> will discard previously selected files (see below); if the files were produced by the module, and were not previously saved, a warning window will pop-up, allowing to proceed or to stop removing the selected items. 
<p>
Several buttons are available in the panel below the loaded files window: 
<p><center>
<img SRC="somo-HPLC-SAXS_panel1.png" ALT="SOMO HPLC-SAXS files commands panel">
</center>
<p>

<b><i>Sel. all</i></b> will select all files.<p>

<b><i>Sel. Unsel.</i></b> will allow toggling the selection between selected files and everything else not currently selected.<p>

<b><i>Adv. Sel.</i></b> will open up a panel in which several selection options can be utilized (see <a href=saxs_hplc_nth.html>here</a>).<p>

<b><i>View</i></b>, active when up to ten datasets are selected, will show them in text format.<p>

<b><i>Movie</i></b>: Pressing this button will open a pop-up window with the commands allowing to view in the main graphics window of the <b>US-SOMO <i>HPLC-SAXS</i></b> module a series of selected data files in a movie-like manner, and to optionally save each frame as an image for real movie-making operations (see <a href=somo_saxs_hplc_movie.html>here</a>).<p>

The <b><i>Log X</i></b> (<b><i>Lin X</i></b>) and <b><i>Log Y</i></b> (<b><i>Lin Y</i></b>) buttons allow to toggle between linear and log<sub>10</sub> scaling of the data on the <i>x</i>- and <i>y</i>-axes, respectively (if zero or negative values are present, they will be temporarily removed when the scale is set to log<sub>10</sub> mode, as they cannot be shown on the display in this mode). The buttons will change their respective label once pressed, to underscore what is the action currently available.<p>

Selecting the <b><i>Err</i></b> checkbox, active when up to 10 files are selected, will switch their representation from the dots connected with a line mode, to symbols (diamonds) with their associated SDs represented as error bars mode.<p>

<b><i>Rescale</i></b> adjusts the X-Y axes on the graphics window to maximize the display of selected datasets (no effect on the data themselves).<p>

<b><i>Normalize</i></b> will divide the <i>I</i>(<i>q</i>)</i> data by the stored/entered concentrations.<p>

<b><i>Average</i></b> will produce an average with propagated SDs of selected data. The <i>I</i>(<i>q</i>) values from each frame will be averaged, and then a scaling factor will be determined for each frame against the average resulting frame. The scaling factor for each original frame multiplies the frames's SD. The average intensity SD's are computed as the square root of the sum of the squares of each curves scaled SD's, and this is divided by the number of curves. The resulting datset filename will contain the number of frames averaged, and the initial and final frame numbers, followed by "_avg".<p>

<b><i>To SOMO/SAS</i></b> will transfer selected datasets back into the <b>US-SOMO <i>SAS</i></b> panel.<p>

Each time the <b><i>Width</i></b> button is pressed, it increments the data line (or symbol) size of the plots, until it goes back to the initial value.<p>

<b><i>Color</i></b> shifts the colors used in the graphics window; the operation can be repeated until a better contrast with the background is achieved. Note that the background color can be changed by right-clicking on the plot borders, which will open up a pop-up dialogue panel where all plot characteristics can be modified.<p>

<b><i>Bin</i></b> allows averaging adjacent points in <i>I</i>(<i>q</i>) datasets, starting with the first point in the file and using a binning size defined in a pop-up dialogue:<p>

<center>
<img SRC="somo-HPLC-SAXS_bin.png" ALT="SOMO HPLC-SAXS binning window panel">
</center>
<p>

<b><i>Smooth</i></b> performs a regularization of selected data using a moving window, whose dimension is defined in a pop-up menu (shown below), using a Gaussian smoothing kernel of 2<i>n</i>+1 points.<p>
<center>
<img SRC="somo-HPLC-SAXS_smoothing.png" ALT="SOMO HPLC-SAXS smoothing window panel">
</center>
<p>

<b><i>SVD</i></b> opens a pop-up window were a single-value decomposition analysis (e.g., Williamson et al.,  Biophys J. 94, 4906-4923, 2008) can be performed on the selected data (see <a href=somo_saxs_hplc_svd.html>here</a>). <span style="color:#CC0000">Important:</span> the data must be all on the same grid; if not, a warning message will appear in the bottom left <b><i>Messages</i></b> window: "<span style="color:#CC0000">SVD: curves must be on the same grid, try 'Crop Common' first</span>" (see below for the use of the <b><i>Crop Common</i></b> button).<p>

<b><i>Make I(t)</i></b> is one of the crucial operations in the <b><i>HPLC-SAXS</i></b> module. It allows to generate a series of "chromatograms" (<i>I(t)</i> vs. <i>t</i>, where <i>t</i> can be real elution time or frame number) for each <i>q</i>-value present in the original data files (see below). A test could be automatically performed each time an  <i>I</i>(<i>q</i>) vs. <i>q</i> dataset is converted into an <i>I</i>(<i>t</i>) vs. <i>t</i> dataset to ascertain if any <i>I</i>(<i>t</i>) vs. <i>t</i> "chromatogram" contain useful data, on the basis of a comparison between the signal and its associated SDs, by selecting its relative checkbox and the SD factor in the <b><i>Options</i></b> menu accessible from the button provided at the bottom of this window (see <a href=saxs_hplc_options.html>here</a>).<p>

<b><i>Test I(t)</i></b> Checks the <i>I</i>(<i>t</i>) vs. <i>q</i> selected curves to see if any fail the negative region test as described above.<p>

<b><i>Make I(q)</b></i> is the other crucial operation in the <b><i>HPLC-SAXS</i></b> module. It allows to re-generate <i>I</i>(<i>q</i>) vs. <i>q</i> files for each frame after data treatment in frame- (or time-) space.<p>

<span id="conc_load"></span>
<b><i>Concentration load</i></b> is used to upload any chromatographic data files containing a concentration-related elution profile, such as those produced by UV-VIS absorption or refractive index detectors (the program will then internally keep track of such datasets, distinguishing them from SAXS datasets). By default, the program will look for "*.txt" and "*.csv" files, but the choice could be expanded to other extensions in the file upload dialogue. The currently recognized format for non-CSV concentration data is similar to the SAXS data format with the addition of the string "Frame data" in any place on the first line. The two or three columns of data are the frame number, concentration-related data, and optionally an associated SD value. For loading CSV format concentration data files, see <a href=saxs_hplc_conc_csv_frames.html>here</a>. <p>

<b><i>Repeak</i></b> is used to effectively scale data (usually a concentration-related chromatogram) on the <i>y</i>-axis to a pre-set target (usually a low-<i>q</i>, high-intensity <i>I</i>(<i>t</i>) vs. <i>t</i> chromatogram), selectable in a pop-up window among the data subjected to this operation (this affects the data, a new file is generated with "rp" and the scaling factor added at the end of the filename). See more below on this subject.<p>

<b><i>Set</i></b> will set an already uploaded and currently selected file containing the UV or refractive index profile vs. time or frame number as the source of the concentration-dependent signal.<p>

<b><i>Detector</i></b> will allow to select the type of detector and to enter its calibration constant in a pop-up window (see <a href=saxs_hplc_dctr.html>here</a>).<p>
<hr>

<p><center>
<img SRC="somo-HPLC-SAXS_I_t.png" ALT="SOMO HPLC-SAXS Lysozyme I(t)">
</center>
<p>

Since a typical HPLC-SAXS experiment produces a series of <i>I(q)</i> vs. <i>q</i> data collected at some time interval ("frames"), they can be inserted in a 2D matrix where each line corresponds to a frame number (or time value) and the columns contain the intensities <i>I(q)</i> and their associated SDs at the various scattering angles <i>q</i>. It is then a simple operation to generate another matrix where the lines correspond to the <i>q</i>-values and each column contains the intensities <i>I(t)</i> (and their associated SDs) corresponding to each frame number (or time value). A new data set consisting of <i>I(t)</i> vs. <i>t</i> "chromatograms" for each <i>q</i>-value can then be generated.<br>
In the image above, the original <i>I(q)</i> vs. <i>q</i> data shown in the first image of this Help section have been transformed to <i>I(t)</i> vs. <i>t</i> data by pressing the <b><i>Make I(t)</i></b> button after selecting all files. The  <i>I(t)</i> vs. <i>t</i> data are automatically displayed after the conversion, and the <i>q</i> values are now part of the resulting filenames. Since the <i><b>On Make I(t), discard I(t) with no signal above st. dev. multiplied by</i></b> "2.5" was selected in the <i><b>Options</i></b> menu (see <a href=saxs_hplc_options.html>here</a>), the following <i>Warning message</i> appeared:<p>

<p><center>
<img SRC="somo-HPLC-SAXS_discard_warning.png" ALT="SOMO HPLC-SAXS discard I(t) files warning">
</center>
<p>

In addition, a test is automatically performed to identify regions
within a sliding window (of 25 frames in this case) where the sum
of the intensity is less than the negative of the sum of the
corresponding SD values over the window.  Regions with negative
values could cause problems with the integral baseline subtraction
procedure (see more below). This test identified just a single <i>I(t)</i> vs. <i>t</i>  chromatogram failing it, as shown in a pop-up window:<p>

<p><center>
<img SRC="somo-HPLC-SAXS_negative_integral_warning.png" ALT="SOMO HPLC-SAXS negative I(t) integral warning">
</center>
<p>

Some cropping operations (see below) can be also performed to remove very noisy low-<i>q</i> datasets, such as the first three <i>q</i> values displayed in the Figure above (magenta, olive and greenblue) and/or to truncate the datasets if necessary. All operations are recorded in the bottom left panel.<p>
The file names of produced data are shown in the <b><i>Produced Data</b></i> panel to the centre-left, and can be selected and saved to files using the appropriate buttons below it.<p>

<b><i>Select all</i></b> will select all files in this panel.<p>

<b><i>Invert</i></b> will allow toggling the selection between selected files and everything else not currently selected.<p>

<b><i>Similar</i></b> will search for similar file names after selecting a single file in this panel.<p>

<b><i>Remove</i></b> will discard the selected files.<p>

Two types of files can be produced, csv-style (<b><i>Save CSV</i></b>) or regular 3-columns .dat files (<b><i>Save</i></b>).<p>


<b><i>Show</i></b> will add the selected file(s) among those produced to the ones already displayed in the graphics window.<p>

<b><i>Show only</i></b> will show only the selected file(s) among those produced in the graphics window.<p>

In the <b><i>Messages</i></b> area, the operations performed are tracked, and computed parameters are shown. The display can be copied or cleared from the <i>File</i> pull-down menu. <p>

The last line of the left-side panels contains the <i><b>Help</i></b> and <i><b>Options</i></b> buttons. On pressing the latter, a pop-up panel will be shown:<p>

<center>
<img SRC="somo-HPLC-SAXS_options.png" ALT="SOMO HPLC-SAXS options">
</center>
<p>

See <a href=saxs_hplc_options.html>here</a> for a description of this module.<p>

<hr><p>
Below the <b>US-SOMO <i>HPLC-SAXS</i></b> module graphics panel there are a series of buttons for performing several operations on the files displayed, some of which will become available only when multiple files are selected, or a region of the graph is zoomed, while others will become available only when single files are selected:<p>

<p><center>
<img SRC="somo-HPLC-SAXS_commands1.png" ALT="SOMO HPLC-SAXS commands">
</center>
<p>

When a part of the graph is selected using the mouse/left button, the buttons in the bottom line become all available (only <b><i>Crop Zeros</i></b> and <b><i>Crop Common</i></b> are available when files are just displayed after selection).<p>
<ul>
<li>
<b><i>Select Visible</i></b> will select the files shown in the graphics window, which can be zoomed using the mouse (left click & drag). For instance, this is a practical way of selecting only a few files, by zooming on a region where only them are present.<p>

<li>
<b><i>Remove Vis(ible)</i></b> will instead remove the files shown in the graphics window.<p>

<li>
<b><i>Crop Common</i></b> will crop all selected files so that they have identical x-axis values by dropping points outside of the union of all selected file's x-axis values.<p>

<li>
<b><i>Crop Vis(ible)</i></b> will remove what is shown in the graphics window. For instance, this is practical way to trim the data on the <i>x</i>-axis.<p>

<li>
<b><i>Crop Zeros</i></b> will remove data having zero or negative values in the intensity columns (<span style="color:#CC0000">discouraged: a warning panel will pop-up, asking the user whether she/he really wants to proceed, since experimental zero or negative values have statistical significance</span>).<p>

<li>
<b><i>Crop Left</i></b> and <b><i>Crop Right</i></b> will remove one point on the left or right of the selected data, respectively.<p>

<li>
<b><i>Undo</i></b> will undo the last operation.<p>

<li>
<b><i>Legend</i></b> will turn on below the graphics window a display of the correspondence between colours and filenames (automatically disabled if the selected files are 20 or more).<p>
</ul>

Of the top-row commands, two deserve already a comment at this point:<p>
<ul>
<li>
<b><i>CorMap Analysis</i></b> will launch a pairwise similarity comparison between all currently selected datasets, according to our implementation of <i>P</i>-value computations and comparisons derived from the Correlation Map method developed by Franke
</span><span lang="en-US"><i>et al.</i></span><span lang="en-US">
(Franke D, Jeffries CM, Svergun DI. Correlation Map, a goodness-of-fit test for one-dimensional X-ray scattering spectra. Nature Methods, 12, 419-422, 2015). Specialized applications of the CorMap analysis are described at several points below. A general <i><b>CorMap Analysis</i></b> module description with examples can be found <a href=cormap.html>here</a>.<p>

<li>
<b><i>Save plots</i></b> allows saving the data shown in any of the plots currently visualized in csv-formatted files. Pressing it will open a pop-up dialogue window where the location and the root filename for the cvs files can be set.<p>
</ul>


<hr>



Visual inspection of the <i>I(t)</i> vs. <i>t</i> chromatograms can already hint at problems, such as in the lysozyme data here used as an example. In this case, it is evident that many <i>I(t)</i> vs. <i>t</i> chromatograms starting from the low-<i>q</i> region do not return to pre-peak elution baseline intensity values. Most likely, this is due to capillary fouling, and without proper correction these data would be mostly useless. For this, and for less evident cases, an Integral Baseline correction procedure has been devised<br>
The <b>Integral Baseline</b> method is based upon the assumption that capillary fouling deposits are formed in proportion to the sample concentration while exposed to the beam, and that neither the buffer nor the instrumental background are contributing to this effect. That deposition on the capillary does occur is clearly proven by the fact that a steady SAXS signal is maintained even after completion of the protein elution. The theory underlying the Integral Baseline correction procedure can be found <a href=IntegralBaselineTheory.html>here.</a> <p>

To help the user decide if a baseline correction is needed, and to find a proper region of SAXS steady state signal at the end of the chromatograms, the currently implemented Integral Baseline method requires an analysis on blank frames. These "Blanks" (<span style="color:#CC0000"><i>no less than <b>10 frames</b>, possibly at least <b>20 or more</b> must be available</i></span>) should have been collected well before the void volume, and should preferentially be the same ones that were then averaged and subtracted from all the data collected during the chromatogram development.<p>

<p><center>
<img SRC="BlanksLoaded.png" ALT="SOMO HPLC-SAXS Blanks loaded">
</center>
<p>

After Blanks files have been loaded using the <b><i>Add files</b></i> button (see above), their analysis is launched by pressing the <b><i>Blanks analysis</b></i> button. The module will automatically convert the <i>I(q)</i> vs. <i>q</i>  frames into  <i>I(t)</i> vs. <i>t</i>  chromatograms:<p>

<p><center>
<img SRC="BlanksTransformed.png" ALT="SOMO HPLC-SAXS Blanks I(t)">
</center>
<p>

The two vertical magenta lines and their corresponding fields at the bottom of the buttons' zone define the beginning and end regions for the Blanks analysis. By clicking on one of the fields and then moving the mouse on the grey-scale bar-wheel just below the graphics window, these limits can be changed. This can also be done in steps of a single frame by clicking on the "<b><i>&lt;</i></b>" and "<b><i>&gt;</i></b>" buttons placed at the extremities of the bar-wheel. Alternatively, the limits can be manually changed by entering a numerical value in their respective fields.<p>

The Blanks analysis is performed by clicking on the <b><i>CorMap Analysis</i></b> button. This will launch a pairwise Correlation Map analysis (see <a href=cormap.html>here</a> for a descrption of the CorMap implementation in the US-SOMO HPLC-SAXS module). Before the analysis is effectively launched, a pop-up panel will appear:<p>

<p><center>
<img SRC="CorMapSampling.png" ALT="SOMO HPLC-SAXS CorMap sampling pop-up">
</center>
<p>

It was found during the implementation of the Blanks analysis that finely spaced <i>q</i> values might result in cross-correlation effects in the CorMap analysis (see also <a href=cormap.html>here</a>). Therefore, this pop-up panel will allow to chose a sampling in <i>q</i> space to eliminate or at least alleviate this problem. Since usually a one-every-two values sampling is sufficent, this can be directly done by pressing the <i>Sample alternate q points</i> button. Larger sampling intervals can be chosen by entering an integer value after pressing the <i>Specify a larger gap in q points</i> button. If no sampling is wanted, the <i>Continue</i> button should be pressed.<br>
A second pop-up option will also allow to start the CorMap analysis above a chosen <i>q<sub>min</sub></i> value, to avoid including very noisy, low-<i>q</i> values in the analysis:<p>

<p><center>
<img SRC="CorMapSampling_minq.png" ALT="SOMO HPLC-SAXS CorMap minimun q value pop-up">
</center>
<p>

After these choices are made, the analysis is effectively launched, and the results are shown in a new pop-up panel (see <a href=cormap.html>here</a> for a full description of the CorMap implementation):<p>

<p><center>
<img SRC="CorMapBlanksAlternatePoints.png" ALT="SOMO HPLC-SAXS CorMap of Blanks with alternate points">
</center>
<p>

The pop-up panel begings by reporting on the top bar the type of analysis (here "Blanks mode t 1 - 89"), the max <i>q</i> limit used (here 0.05 &Aring;<sup>-1</sup>), and the sampling used (here "Only every 2<sup>nd</sup> <i>q</i> value selected").<p>
Three plots are present on the top of the panel:
<ul>
<li>
A <b>Pairwise P-value map</b>, a square matrix in which the square (<i>i</i>,<i>j</i>) contains the <i>P</i>-value
resulting from the (<i>i</i>,<i>j</i>) curves represented by a three color code: green for <i>P</i> &ge; 0.05, yellow for 0.01 &le; <i>P</i> &le; 0.05, and red for <i>P</i> &lt; 0.01. The labels on the axes correspond to the reference numbers given to the analyzed frames (see below).<p>

<li>
A <b>Red pair % histogram</b> plot as a function of the time/frame number, derived from the analysis of the pairwise <i>P</i>-value map in terms of the distribution of values between the three classes with an emphasis on the % of red squares.<p>

<li>
A <b>Red cluster size histogram</b>, derived from an evaluation of the average size of clusters of horizontally and/or vertically adjacent "red" squares. After careful examination of several indicators derived from the <i>P</i>-value map analysis, this was chosen as the most reliable to determine the global similarity between all frames of the considered subset. <p>
</ul>

The text area reports first the the pairwise <i>P</i>-map color definition, and then where to look for the correspondence between the axis ticks and the actual data. Then follows a summary of the most relevant data:<p>

<ul>
<li>
A summary of the resulting <i>P</i> values pairs in terms of the green+yellow sum % and red % values.<p>

<li>
The average one-to-all <i>P</i> value &#177; its SD (in parentheses the % SD value) and the % of red values &#177; their SD (in parentheses the % SD value.)<p>

<li>
The red cluster count, their average size &#177; their SD (in parentheses the % SD value) and their average  &#177; SD size as % of the total area.<p>

<li>
The red cluster maximum size (with its % in respect to the total area), the number of occurences of that cluster size, and the position of the first occurence.<p>
</ul>

Below these summaries, the first list reports the correspondence between the "Reference numbers" (<b>Ref</b>) assigned to each dataset (here frames) and its "real" name. This was introduced to avoid having to deal with complicated names in the axes legends on the plots (in this case, the frame numbers that were extracted from the <i>I(t)</i> vs. <i>t</i> filenames start at "1", so they are equal to the "Ref" numbers). The list also reports for each frame the <i>Avg. P value</i>, the <i>Min. P value</i>, and the <i>% Red</i> points.<br>
At the end of the first list, a second list reports all the pairwise comparisons results, including the number of points compared (<i>N</i>), followed by the <i>q</i> point position where the longest streak occurs (<i>Start point</i>), then the length of the longest streak (<i>C</i>), and finally the <i>P-value</i> of a streak of length <i>C</i> occurring in a sequence of <i>N</i> points, as shown in the image below:<p> 

<p><center>
<img SRC="CorMapBlanksList.png" ALT="SOMO HPLC-SAXS CorMap Blanks list">
</center>
<p>

At the end of the text area, a checkbox is present. If selected, the paiwise analyses will be adjusted for multiple testing using the Holm-Bonferroni approach (Holm, S. A simple sequentially rejective multiple test procedure. Scandinavian Journal of Statistics 6:65-70, 1979; see <a href=cormap.html>here</a>):<p>

<p><center>
<img SRC="CorMapBlanksAlternatePointsHB.png" ALT="SOMO HPLC-SAXS CorMap of Blanks with alternate points using Holm-Bonferroni">
</center>
<p>

Note that in this case the Holm-Bonferroni multiple testing adjustment on a dataset where a one-every-two <i>q</i>-values sampling was applied has produced a completely green pairwise <i>P</i>-values map. Without sampling, this is what is obtained without the Holm-Bonferroni adjustment:<p>

<p><center>
<img SRC="CorMapBlanksNoAlternatePoints.png" ALT="SOMO HPLC-SAXS CorMap of Blanks no alternate points">
</center>
<p>

and with Holm-Bonferroni adjustment:<p>

<p><center>
<img SRC="CorMapBlanksNoAlternatePointsHB.png" ALT="SOMO HPLC-SAXS CorMap of Blanks no alternate points using Holm-Bonferroni">
</center>
<p>


All data listed in the CorMap analyis pop-up window can be saved in a csv-type file with the <b><i>Save</i></b> button. Previously analyzed datasets can be recalled with the <b><i>Load</i></b> button.<p>
After closing the CorMap analysis window, the Blanks data can be accepted by pressing the <b><i>Keep</i></b> button. <b><i>Cancel</i></b> will instead discard the current CorMap analysis.<p>

The Integral Baseline analysis of the actual sample frames can then begin. Contrary to what was required in our previously developed Integral Baseline method, the current version requires that <b>all</b>  <i>I(t)</i> vs. <i>t</i> chromatograms must be selected before hitting the <b><i>Baseline</i></b> button.<br>
In any case, on pressing <b><i>Baseline</i></b> a first pop-up warning message will always appear:<p>

<p><center>
<img SRC="Baseline_blanks_noblanks.png" ALT="SOMO HPLC-SAXS Int Bas Blanks/no Blanks question">
</center>
<p>

This allows the user to proceed without using a Blanks reference set to judge if a stable baseline has been reached at the end of the chromatograms. In this case, only the Holm-Bonferroni adjusted pairwise comparison will be used.<p>

If Blanks are to be used, a second pop-up warning message will appear:<p>

<p><center>
<img SRC="IntegralBaselineBlanksWarning.png" ALT="SOMO HPLC-SAXS Int Bas Blanks Warning">
</center>
<p>

alerting that a blanks analysis is needed to proceed any further, and offering up to three options:<p>

<ul>
<li>
<i>Load blanks</i>, which will allow to load <i>I</i>(<i>q</i>) vs. <i>q</i> Blanks files  to be subjected to the analysis as described above;<p>

<li>
<i>Load previous analysis</i>, which will allow to select a previously saved Blanks analysis cvs file;<p>
</ul>

and, if Blanks were analyzed during the current session,<p>

<ul>
<li>
<i>Accept currently analyzed blanks</i> (followed by the filename of the currently analyzed blanks).<p>
</ul>

Another pop-up will then appear, reminding that the first step in the Integral Baseline procedure is to find a final region of constant intensity:<p>

<p><center>
<img SRC="IntegralBaselinePrescription.png" ALT="SOMO HPLC-SAXS integral baseline prescription">
</center>
<p>

After pressing <i>OK</i>, the graphics window will present all the selected <i>I(t)</i> vs. <i>t</i> chromatograms  and switch to the <i>Baseline</i> mode of analysis:<p>

<p><center>
<img SRC="somo-HPLC-SAXS_integral_baseline1a.png" ALT="SOMO HPLC-SAXS integral baseline setting 1">
</center>
<p>

As shown in the image above, this superimposes to the selected chromatograms three vertical lines on the right side, the last two lines of buttons under the graphics window are replaced by three colored fields (magenta-red-magenta), and a dashed line is drawn horizontally (orange). In addition, a <i>Fix window width</i> checkbox with its associated magenta-colored field in now present (<b>default: 20 frames, unchecked</b>), as well as a new <b><i>Find best region</i></b> button.<br>
The first vertical magenta line, which by default is positioned at 75% of the available frames, has multiple usages:<p>

<ul>
<li>
It defines the starting frame of a sliding window over which a <b>CorMap</b> analysis will be carried out;<p>

<li>
It will also define the first frame where the <b>CorMap</b> analysis will start;<p>

<li>
When the Integral Baseline is calculated, it will be the end point of the computations (but the calculated baseline, which will be constant beyond this point, will be then subtracted up to the last frame).<p>
</ul>

The second vertical magenta line defines the end of the sliding window (<b>default: 20 frames</b> beyond the first magenta line).<p>

The vertical red line defines the end for the sliding window analysis (<b>default position: 5 frames</b> from the end of the available frames).<p>

The horizontal orange line represents the average intensity across the current window of the lowest <i>q</i>-value among the selected <i>I(t)</i> vs. <i>t</i> chromatograms.<p>

It is important to remind that the baseline is set to be at zero at the beginning of the data on the left side.<p>

The positions of the three vertical lines are indicated in the three background color-coded fields. By cliking on one of the fields, the corresponding vertical line position can be changed using either the grey-shades bar-wheel, or the "<b>&lt;</b>" and "<b>&gt;</b>" buttons at its sides. Manual values can be also entered.<p>

If the <i>Fix window width</i> checkbox is not selected, moving either of the two vertical magenta lines will also change the width of the sliding window.<p>

It is then best to first define a window width by moving either one of the vertical magenta lines, and then fix it by selecting the <i>Fix window width</i> checkbox. At this point, the entire window can by positioned by using either of the two vertical magenta lines. It is suggested to position it in a region where there is still some visible intensity decay, as shown below:

<p><center>
<img SRC="somo-HPLC-SAXS_integral_baseline2a.png" ALT="SOMO HPLC-SAXS integral baseline setting 2">
</center>
<p>

The baseline analysis is then completed by pressing the <b><i>Find best region</i></b> button.<p>
This will launch a special <b>CorMap</b> analysis in which first a global CorMap calculation will be carried out between the entire range of frames from the first vertical magenta line to the vertical red line. Subsets of this CorMap analysis corresponding to the sliding window regions will then be extracted and compared with the average of all possible CorMap analysis results extracted from the pre-analyzed Blanks data for a sliding window of the same size.<p>

In addition, the analysis will calculate the integrated average intensity at each frame of all the <i>I</i>(<i>q</i>) values from the minimum <i>q</i>-value selected up to the <i>q<sub>max</sub></i> defined in the <a href=saxs_hplc_options.html><b>Options</b></a> panel (<b>default: 0.05 &Aring;<sup>-1</sup></b>).<p>
The results will appear in two pop-up panels. The first one is analogous to the one appearing after the Blanks analysis:<p>

<p><center>
<img SRC="somo-HPLC-SAXS_integral_baseline3a.png" ALT="SOMO HPLC-SAXS integral baseline Sample CorMap">
</center>
<p>

Here, it can be appreciated the almost completely red left and top sides of the <i>Pairwise P value map</i> plot, originating from the fact that regions on the descending side of the elution peak were included in the analysis. This also heavily affects the right-side <i>Red cluster size histogram</i>, with an almost invisible huge size (&asymp;5000) but extremely low count cluster greatly compressing the scale. If we zoom on the low red cluster size region, this is what becomes visible:<p>

<p><center>
<img SRC="somo-HPLC-SAXS_integral_baseline3b.png" ALT="SOMO HPLC-SAXS integral baseline Sample CorMap zoom">
</center>
<p>

But most relevant is the second pop-up panel that will appear on top of the first:

<p><center>
<img id="baselinebest" SRC="somo-HPLC-SAXS_integral_baseline3c.png" ALT="SOMO HPLC-SAXS integral baseline Sample CorMap analysis">
</center>
<p>

The graph in this panel is composed of two plots, both as a function of the starting window position. The bottom histogram (left-side <i>y</i>-axis scale) reports the average red cluster size for each window in the sliding window ensemble. The horizontal green solid line defines the Blanks average red cluster size for all possible windows of the same size as the sliding window utilized for the Sample analysis (the dotted line represents + 1 SD). The bars in the histograms are colored red when they are above the Blanks + 1 SD value, while cyan and white when they are &le; the Blanks + 1 SD value, with the white being the lowest value(s) (equal values are possible).<p>

The top plot (right-side <i>y</i>-axis scale) reports the averaged <i>I</i>(<i>q</i>) for <i>q</i> &le; the <i>q<sub>max</sub></i> value (0.05 &Aring;<sup>-1</sup> by default, as set in the <b>Options</b>), as the solid orange line, with the dotted orange lines representing &plusmn;1 SD. The solid magenta line defines the zero value expected for blanks-subtracted data when only buffer is present.<p>
The goal of this combined analysis is twofold:<p>
<ul>
<li>
To find region(s) of steady-state intensity;<p>
<li>
To compare the average integrated <i>I</i>(<i>q</i>) intensity with the zero value expected for pure buffer conditions.<p>
</ul>

The first message appearing in the text region concerns the second of the points listed above.<p>
<ul>
<li>If the average integrated <i>I</i>(<i>q</i>) &plusmn;1 SD vs. starting frame position plot is <b>always above</b> the zero reference line <b>and</b> there is at least one occurrence of an average red cluster size being <b>equal or less</b> than the Blanks' average red cluster size +1 SD, the message "<i>Integral baseline correction is possible</i>" appears.<p>
<li>If the average integrated <i>I</i>(<i>q</i>) &plusmn;1 SD vs. starting frame position plot is <b>always above</b> the zero reference line <b>but</b> the average red cluster sizes are always <b>higher</b> than the Blanks' average red cluster size +1 SD, the message "<i>Integral baseline correction would be possible, but no steady-state end region has been identified</i>" appears.<p>
<li>If the average integrated <i>I</i>(<i>q</i>) &plusmn;1 SD vs. starting frame position plot <b>crosses and goes below</b> the zero reference line, <b>irrespective</b> of the average red cluster size status, the message "<i>Integral baseline correction is not recommended</i>" appears.<p>
</ul>

Below the summary sentence, a first report of the baseline analysis is printed. It contains:<p>
<ul>
<li>
The root name of the files analyzed;<br>
<li>
The <i>q</i> sampling interval;<br>
<li>
The CorMap analysis <i>q<sub>max</sub></i>;<br>
<li>
A list of the best starting positions for end frames (that span a length equal to the chosen sliding window size) where the average red cluster size is within 1 SD similar to those of the Blanks (white bars in the histogram; if no white bars are present, green bars will be listed; if neither white of green bars are present, a single, lowest count bar will be listed, colored yellow in the histogram);<br>
<li>
In orange color, the frame position of the lowest average integrated intensity.<p>
</ul>

A second block of information is then printed further down, containing Blanks-related information:<p>
<ul>
<li>
The root name of the Blanks frames files utilized in this analysis;<br>
<li>
Their <i>q</i> sampling interval;<br>
<li>
The maximum available sliding window width;<br>
<li>
The used sliding window width;<br>
<li>
The number of sliding windows averaged;<br>
<li>
The red cluster average size for the used sliding window;<br>
<li>
And its associated SD.<p>
</ul>

The user should then examine the information provided and consider the suggestion made at the top of the text window:<p>
If the averaged integrated intensity -1 SD reaches at some point the zero line, then no Baseline correction is likely necessary.<p>

If the averaged integrated intensity -1 SD at some point crosses and goes +1 SD below the zero line, then other issues might be present, such as incorrect Blanks subtraction, or drifting problems. In the latter case, a Linear Baseline correction might be indicated (see <a href=somo_saxs_hplc_linear_baselines.html>here</a>).<p>

If the averaged integrated intensity is always above +1 SD of the zero line, then an Integral Baseline correction could be necessary. The second condition warranting it is that there is an end region where a sufficient number of Sample frames (equal to the sliding window size by definition) is judged by the average red cluster size of the Pairwise P value Map to be similar within +1 SD of the average Blanks frames. Those are the starting frames listed in the first block of summary information, but beware of the presence of a single yellow-colored starting frame: it means that no frames passed the stringent Pairwise P value Map average red cluster size test, and that the listed frame is only the one having the lowest average red cluster size (which can be much higher than the Blanks average red cluster size). The user could try repeating the analysis using a different (smaller) sliding window size. Check also the starting/ending positions to be sure to include an appropriate end region for this analysis.<p>

When both the Integral Baseline applicability conditions are met, the user could automatically transfer the position of the window into the Baseline module, by clicking on the <b><i>Set region in the HPLC window</i></b> bar at the bottom of the an analysis window. This will open a pop-up panel:<p>

<p><center>
<img SRC="somo-HPLC-SAXS_integral_baseline_setwindow.png" ALT="SOMO HPLC-SAXS integral baseline setting window in Baseline module">
</center>
<p>

listing all possible starting positions for the baseline window, beginning with the farthest one. The user should pick a position matching with the lowest average integrated intensity frame position (orange colored text). If more than a lowest average integrated intensity frame is available, it is advisable to pick an earlier one, to avoid a potential undercorrection when integral baseline subtraction is performed. Once a position is chosen, clicking on <i>OK</i> will transfer it to the Baseline module panel:<p>

<p><center>
<img SRC="somo-HPLC-SAXS_integral_baselines1.png" ALT="SOMO HPLC-SAXS integral baseline applied higher q">
</center>
<p>

To verify what the Integral Baseline will effectively produce, <b><i>Test Baseline</i></b> should be launched. This will show in scroll mode every original <i>I(t)</i> vs. <i>t</i> chromatogram, a smoothed version using a Gaussian smoothing kernel of 2<i>n</i>+1 points (where <i>n</i> is set in the <a href=saxs_hplc_options.html>Options</a> panel, with <i>n</i> = 3 as default), the iterations in the Integral Baseline computation (whose number is also set in the <a href=saxs_hplc_options.html>Options</a> panel, with 5 as default), and the final, integral baseline-corrected chromatogram:<p>

<p><center>
<img SRC="somo-HPLC-SAXS_integral_baseline_test.png" ALT="SOMO HPLC-SAXS integral baseline test">
</center>
<p>

In the example shown above, blue is an original <i>I(t)</i> vs. <i>t</i> chromatogram at <i>q</i> = 0.00791 &Aring;<sup>-1</sup>, white its smoothed version with the default settings, cream, olive green, orange and pale yellow are integral baseline iterations 1, 2, 3 and 5, respectively (the 4<sup>th</sup> iteration is not visible, completely superimposed by the 5<sup>th</sup>), and light green is the final, integral baseline-corrected <i>I(t)</i> vs. <i>t</i> chromatogram. The Gaussian smoothing is applied to remove large oscillations in the original <i>I(t)</i> vs. <i>t</i> chromatogram, giving rise occasionally to values below the current integral baseline iteration, leading then to addition rather than subtraction in the computations. The final integral baseline is then subtracted from the original <i>I(t)</i> vs. <i>t</i> chromatogram, not the smoothed one.<p>
As can be seen in the example above, the procedure appears to have produced a reasonable correction. All <i>I(t)</i> vs. <i>t</i> chromatograms can be checked in the <b><i>Test baseline</i></b> mode, which can be abandoned by pressing <b><i>Cancel</i></b>.<p>
The Integral Baseline procedure can now be applied to all selected <i>I(t)</i> vs. <i>t</i> chromatograms by pressing <b><i>Baseline apply</i></b>. If files that failed the negative regions test within a sliding window (of 25 frames in this case) where the sum
of the intensity is less than the negative of the sum of the corresponding SD values over the window are present, this message will again appear:<p>

<p><center>
<img SRC="somo-HPLC-SAXS_negative_integral_warning.png" ALT="SOMO HPLC-SAXS negative I(t) integral warning">
</center>
<p>

After pressing <i>Ok</i>, all the integral baselines will be computed and then subtracted from the <i>I(t)</i> vs. <i>t</i> chromatograms. When the overall computed change in baseline is found to be negative, no baseline correction is applied. A pop-up panel will alert the user listing the first 20 such occurences and giving the number of all the others found:<p>

<p><center>
<img SRC="somo-HPLC-SAXS_negative_integral_baseline_warning.png" ALT="SOMO HPLC-SAXS negative integral baseline warning">
</center>
<p>

Each resulting baseline-subtracted chromatogram will have a "-bi" added after the <i>q</i> value and an "-s" at the end of the filename to indicate that an integral baseline subtraction was applied (if a linear baseline option is used, the first label will be "-bl"). The numerical value of the overall change in baseline and the alpha value (for an explanation alpha see <a href=saxs_hplc_options.html>here</a>) are also added to the filename of the produced files, as shown in the <b><i>Data files</i></b> panel. Files where no baseline was subtracted will have a "0s" at the end of the filename:<p> 

<p><center>
<img SRC="somo-HPLC-SAXS_integral_baseline_finalset.png" ALT="SOMO HPLC-SAXS integral baseline final set">
</center>
<p>

<hr>
If the baseline procedure without Blanks was selected, the Baseline module will proceed slightly differently.<p>

First, the "sampling" pop-ups will appear, since in this case the sampling is not set by what was used for the Blanks:<p>

<p><center>
<img SRC="CorMapSampling.png" ALT="SOMO HPLC-SAXS CorMap sampling pop-up">
</center>
<p>

<p><center>
<img SRC="CorMapSampling_minq.png" ALT="SOMO HPLC-SAXS CorMap minimun q value pop-up">
</center>
<p>

In the following example, no sampling was applied. The sliding window size and the beginning-end of the baseline analysis region are set as with the procedure with Blanks (see above), and the <i><b>Find best region</i></b> button is then pressed. The CorMap results will this time be displayed with the Holm-Bonferroni checkbox automatically selected:<p>

<p><center>
<img SRC="somo-HPLC-SAXS_integral_baselines_noblanksCM.png" ALT="SOMO HPLC-SAXS integral baseline Find best region CM no blanks">
</center>
<p>

The second pop-up will also appear:<p>

<p><center>
<img SRC="somo-HPLC-SAXS_integral_baseline_HB.png" ALT="SOMO HPLC-SAXS integral baseline Sample CorMap HB analysis">
</center>
<p>

In respect with the analysis including a comparison with the Blanks (see above), there are two differences:<p>

<ul>
<li>
The histogram reports the Red pair % instead of the Average Red Cluster size. This is because with the Holm-Bonferroni adjustment the formation of red cluster is severely inhibited.<p>
<li>
The Blanks average line is obviously absent. The cut-off to mark the histogram bars white is set to 1%. If no window reaches this level, the lowest window will be marked with a yellow color in the histogram.<p>
</ul>
All other functionalities are as with the analysis including the Blanks comparison.<p> 


<hr>
A first assessment of the results of the Integral Baseline subtraction can be done by comparing two identical subsets of <i>I</i>(<i>t</i>) vs. <i>t</i> chromatograms before and after correction. In the figure below, the subsets are from <i>q</i> = 0.00791 to <i>q</i> = 0.05029 &Aring;<sup>-1</sup> scaled on each other in a frame interval corresponding to the half-height of the peak, before (top panel) and after (bottom panel) baseline subtraction:<p>

<p><center>
<img SRC="IntegralBas_Scaling.png" ALT="SOMO HPLC-SAXS Integral Baseline results comparison by scaling">
</center>
<p>

The fact that the right-hand sides of the peaks are nicely superimposed after baseline subtraction validates a posteriori the procedure used to build the baseline, since for a single species the elution peaks at different <i>q</i>-values should be strictly proportional to each other.<p>

More checks of the Integral Baseline subtraction correctness can be performed using the <b><i>Trial make I(q)</b></i> mode. In this mode, the selected <i>I</i>(<i>t</i>) vs. <i>t</i> chromatograms are temporarily transposed back into <i>I</i>(<i>q</i>) vs. <i>q</i> frames and can be analyzed by either scaling or Guinier approximation utilities. In the example below, we have selected a subset of <i>q</i>-values from &asymp;0.008 to &asymp;0.21 &Aring;<sup>-1</sup>, and we have pressed the <b><i>Trial make I(q)</b></i> button:

<p><center>
<img SRC="somo-HPLC-SAXS_test_I_q_select.png" ALT="SOMO HPLC-SAXS test I(q) selection">
</center>
<p>

This will bring up again the gray-shades wheel-bar and change the two lowermost bars with the buttons below the graphics window. At the bottom, a <i>Time range for I(q):</i> label will appear, followed by two fields with red background indicating the region subjected to the <b><i>Test I(q)</i></b> procedure. The limits can be changed by either clicking on each red-colored field and then using the gray-shades bar-wheel at the top, or on the "<b><i>&lt;</i></b>" and "<b><i>&gt;</i></b>" buttons placed at its sides. Alternatively, if a region was pre-selected with the mouse, it can be applied by clicking on the <b><i>Vis. range</i></b> button. In this example, we have set the <i>Time range for I(q)</i> limits from frame 1100 to 1130. <p>  

Two operations can be then performed. Pressing the <b><i>Scale Analysis</i></b> button on the row above will change the layout in this way (note that, by pressing <b><i>Log X</i></b> and <b><i>Log Y</i></b> on the left-side commands panel, both axes have also been changed to log<sub>10</sub>):<p>

<p><center>
<img SRC="somo-HPLC-SAXS_test_I_q_scale.png" ALT="SOMO HPLC-SAXS test I(q) scale layout">
</center>
<p>

The two lowermost rows now display the tools for scaling the back-generated temporary <i>I</i>(<i>q</i>) vs. <i>q</i> curves on top of each other. The two red-background fields now indicate the actual <i>q range for scaling</i>, which can be adjusted by clicking on each field and using the gray-shades bar-wheel at the top or on the "<b><i>&lt;</i></b>" and "<b><i>&gt;</i></b>" buttons placed at its sides; two vertical red lines will mark the corresponding positions on the graph. The <b><i>Reset q range</b></i> button will re-expand the <i>q</i> range.<br>
The last row contains the scaling settings/commands:<p>
<ul>
<li>
The <i>Scale to:</i> round checkboxes will scale the curves to either the <i>Minimum</i> (<b><i>default</i></b>) or the <i>Maximum</i> values among the selected curves.<p>

<li>
The <i>Save interpolated to target</i> checkbox ensures all <i>q</i> or <i>t</i> grids of the data will be identical by interpolating each curve to the minimum or maximum intensity curve.  This is a convenience tool to allow curves generated on different grids to be put on a common grid.
<p>

<li>
<b><i>Reset scaling</i></b> will return to the initial situation.<p>

<li>
<b><i>Apply</i></b> will perform the scaling.<p>

<li>
The <i><b>Create scaled set</b></i> will generated an actual set of scaled data which can be then saved as files.<p>

</ul><p>

In the image below, the scaling has been performed on the indicated <i>q</i> range. The <i>Messages</i> panel reports the statistics of the scaling process as applied to each curve scaled on the one with the lowest intensity:

<p><center>
<img SRC="somo-HPLC-SAXS_test_I_q_scale1.png" ALT="SOMO HPLC-SAXS test I(q) scaled set">
</center>
<p>

By pressing <b><i>Residuals</i></b>, the residuals of the scaling operation are also shown. 

If the <b><i>Scroll</b></i> checkbox is selected, the scaled files can be examined one at a time, scrolling through them using the gray-shades wheel-bar or the "<b><i>&lt;</i></b>" and "<b><i>&gt;</i></b>" buttons placed at its sides. The file name of the data currently shown will appear below the gray-shades wheel-bar, as shown here:<p>

<p><center>
<img SRC="somo-HPLC-SAXS_test_I_q_scale2a.png" ALT="SOMO HPLC-SAXS test I(q) scaled set blow-up">
</center>
<p>

A <b>CorMap</b> analysis can be also performed on the scaled set by pressing <b><i>CorMap Analysis</i></b>. This will produce two pop-up outputs, one containg the CorMap analysis on the full <i>q</i>-range available:<p>

<p><center>
<img SRC="somo-HPLC-SAXS_test_I_q_scale_cormap_full.png" ALT="SOMO HPLC-SAXS test I(q) scaled set CorMap full range">
</center>
<p>

and the other limited to the <i>q<sub>max</sub></i> value presente in the <b><i>Options</i></b> (0.05 &Aring;<sup>-1</sup> in this case):<p>

<p><center>
<img SRC="somo-HPLC-SAXS_test_I_q_scale_cormap_0_05.png" ALT="SOMO HPLC-SAXS test I(q) scaled set CorMap q=0.05">
</center>
<p>

Note that one-every-other <i>q</i>-value has been utilized in this analysis. As can be seen, both the pairwise <i>P</i>-value map and the red pair % histogram indicate that with the exception of three frames of the ensemble (#2, #9 and #31, corresponding to frames #1101, #1108 and #1130), most are similar to all the others, with an overall &asymp;8-9% of red pairs. Limiting the lower <i>q</i>-values to 0.015 &Aring;<sup>-1</sup> reduced this overall % red pairs count to 6% (not shown), with frames #1101 and #1130 still being substantially different from all others.<p>

If the <i>Holm-Bonferroni adjusted P values</i> checkbox is selected, these will be the results:<p>

<p><center>
<img SRC="somo-HPLC-SAXS_test_I_q_scale_cormap_fullHB.png" ALT="SOMO HPLC-SAXS test I(q) scaled set CorMap full range HB adjusted">
</center>
<p>

<p><center>
<img SRC="somo-HPLC-SAXS_test_I_q_scale_cormap_0_05HB.png" ALT="SOMO HPLC-SAXS test I(q) scaled set CorMap q=0.05 HB adjusted">
</center>
<p>

Clearly, the combination of the one-every-other <i>q</i>-value sampling and the Holm-Bonferroni adjustment is over-permissive for this dataset. If the analysis is repeated without the sampling, these are the results:<p>

<p><center>
<img SRC="somo-HPLC-SAXS_test_I_q_scale_cormap_fullHB_nosampl.png" ALT="SOMO HPLC-SAXS test I(q) scaled set CorMap full range HB adjusted no sampling">
</center>
<p>

<p><center>
<img SRC="somo-HPLC-SAXS_test_I_q_scale_cormap_0_05HB_nosampl.png" ALT="SOMO HPLC-SAXS test I(q) scaled set CorMap q=0.05 HB adjusted no sampling">
</center>
<p>

In this case, similar results are obtained as with the one-every-other <i>q</i>-value sampling and no Holm-Bonferroni adjustment.<p>

Pressing <b><i>Cancel</i></b> will completely exit from the <b><i>Test I(q)</i></b> mode.<p>

Pressing <b><i>Trial make I(q)</i></b> will instead exit from the scaling mode only.<p>

Pressing then the <b><i>Guinier</i></b> button will call the other test function available in the <b><i>Test I(q)</i></b> mode:<p>

<p>
If the maximum <i>q</i> value for the currently examined <i>I</i>(<i>q</i>) vs. <i>q</i> dataset does not reach the <b><i>MW[RT] q<sub>max</sub> cut-off</b></i> value present in the <i><b>Options</b></i> panel for the Rambo and Tainer approximate molecular weight calculation method (see <a href=saxs_hplc_options.html>here</a>), a warning will appear:
<p>
<p><center>
<img SRC="somo-HPLC-SAXS_RT_warning1.png" ALT="SOMO HPLC-SAXS test I(q) Guinier Rambo-Tainer q(max) cut-off warning">
</center>
<p>

Pressing <i><b>Ok</i></b> will allow to proceed, showing the <i>Guinier</i> mode of the <b><i>Trial make I(q)</b></i> panel (in the case examined, the pop-up alert dit <b>not</b> appear, as the <i>q<sub>max</sub></i> utilized was &gt;0.2 &Aring;<sup>-1</sup>):

<p>
<p><center>
<img SRC="somo-HPLC-SAXS_test_I_q_Guinier.png" ALT="SOMO HPLC-SAXS test I(q) Guinier test initial">
</center>
<p>

The lowermost row now carries the tools necessary to perform a Guinier analysis on the back-generated temporary <i>I</i>(<i>q</i>) vs. <i>q</i> curves:<p>
<ul>
<li>
The <i>q range:</i> fields (red background) indicate the <i>q</i> range currently selected. By clicking on each one and using the gray-shades bar-wheel at the top or the "<b><i>&lt;</i></b>" and "<b><i>&gt;</i></b>" buttons placed at its sides, the <i>q</i>-range can be changed.<br>
<li>
The <i>plot extension:</i> fields provide a <i>q</i> range extension of the Guinier and Residuals plots, allowing additional <i>q</i> range before (left box) and after (right) the Guinier range to be shown. By clicking on one and using the gray-shades bar-wheel at the top or the "<b><i>&lt;</i></b>" and "<b><i>&gt;</i></b>" buttons placed at its sides, the <i>q</i>-range extension can be changed.<br>
<li>
The <i>SD</i> checkbox controls if the linear regressions for the Guinier analyses are carried out with SD weighting (<b><i>default: checked</b></i>).<br>
<li>
The <i>qmax*Rg</i> checkbox and its associated field enable a sequential routine which examines, starting from the higher <i>q</i> value utilized in the regression (<i>q<sub>max</sub></i>), if the product <i>q<sub>max</sub></i>*<i>R<sub>g</sub></i> is &le; the limit set in the apposite field (the <b><i>default</b></i> value is set in the <b><i>Options</b></i> panel). If the products exceeds the limit, that <i>q<sub>max</sub></i> value is dropped, and the regression is repeated utilizing the next lower <i>q</i> value. The test is repeated until a <i>q<sub>max</sub></i> value satisfying the <i>q<sub>max</sub></i>*<i>R<sub>g</sub></i> &le; set limit is found. It is highly advisable to <b>deselect</b> this checkbox before manually changing the <i>q range</i> fields, and to <b>re-select</b> it afterwards, otherwise the program will continuously repeat the <i>q<sub>max</sub></i>*<i>R<sub>g</sub></i> routine while the limits are manually moved.<p>
</ul>
At the bottom of this window region, the averages values for all the curves are reported, and they include:<br>
<ul>
<li>
The number of curves used (<b><i>Avg. xx curves</i></b>);<br>
<li>
The average <i><b>qmax*Rg</i></b> (where <i><b>qmax</b></i> is the maximum <i>q</i> value included in the Guinier analysis), with the range in square brackets;<br>
<li>
The average <i><b>Rg</i></b>, with the SD in round brackets and the range in square brackets;<br>
<li>
The average intensity extrapolated at 0 scattering angle <i><b>I0</i></b>, with the SD in round brackets and the range in square brackets.<br>
<li>
In the line below, an approximates molecular average molecular weight, <b><i>MW[RT]</b></i> is reported, together with its SD (in round brackets) and range [in square brackets], based on the method of Rambo and Tainer (Accurate assesment of mass, models and resolution by small-angle scattering. Nature 496:477-481, 2013). If the available <i>q</i>-range is below that required by the method, a warning message appears in the <i>Messages</i> area.
<p>
</ul>
The regression data for each individual curve are reported in the <i>Messages</i> window.<p>

The residuals of each linear regression can be seen by pressing <b><i>Residuals</i></b>:<p>

<p><center>
<img SRC="somo-HPLC-SAXS_test_I_q_Guinier_adjusted.png" ALT="SOMO HPLC-SAXS test I(q) Guinier test adjusted">
</center>
<p>

Note how the average <i>Rg</i> recovered for this extended set, 14.8&plusmn;0.2 &Aring;, compares well with the 15.0 &Aring; that can be calculated from the lysozyme average NMR structure (1E8L.pdb) using the WAXSiS server (<a href="http://waxsis.uni-goettingen.de/">http://waxsis.uni-goettingen.de/</a>).<p>

As with the scaling option, every individual Guinier plot can be visualized by selecting the <b><i>Scroll</b></i> checkbox and using the gray-shades wheel-bar:<p>

<p><center>
<img SRC="somo-HPLC-SAXS_test_I_q_Guinier_adjusted_scroll.png" ALT="SOMO HPLC-SAXS test I(q) Guinier test adjusted">
</center>
<p>

At this point, a plot of the <i>Rg</i> values across the chromatogram together with a typical <i>I</i>(<i>t</i>) profile (continuous green curve) can be shown by pressing <b><i>Rg plot</i></b>:

<p><center>
<img SRC="somo-HPLC-SAXS_test_I_q_Guinier_Rgplot.png" ALT="SOMO HPLC-SAXS test I(q) Guinier test Rg plot">
</center>
<p>

A new row will appear below the graphics window, with these fields:<p>
<ul>
<li>
<i>Time range for Rg plot:</i> with its two fields. Clicking on each one and using the gray-scale bar-wheel at the top or the "<b><i>&lt;</i></b>" and "<b><i>&gt;</i></b>" buttons placed at its sides will allow to expand or restrict the Time axis (by default, the original time range is shown).<br>

<li>
<i>Rg range:</i> with its two fields. Clicking on each one and using the gray-scale bar-wheel at the top or the "<b><i>&lt;</i></b>" and "<b><i>&gt;</i></b>" buttons placed at its sides will allow to expand or restrict the <i>R<sub>g</sub></i> range. The default is governed by the actual <i>R<sub>g</sub></i> with error bars range with an additional empty space of 2.5% of the total range added to the lower and upper <i>R<sub>g</sub></i> limit. <br> 


<li>
The <i>Lock range</i> checkbox if selected will maintain the actual shown <i>R<sub>g</sub></i> range. Pressing the <b><i>Replot</i></b> button will replot the data keeping the selected <i>R<sub>g</sub></i> range and maximizing the  <i>I</i>(<i>t</i>) profile within the selected time range limits.<br>

</ul><p>

The scroll capability can also be activated in this mode, and the currently selected Guinier plot will be highlighted in the <i>R<sub>g</sub></i> plot:<p>

<p><center>
<img SRC="somo-HPLC-SAXS_test_I_q_Guinier_Rgplot_Scroll.png" ALT="SOMO HPLC-SAXS test I(q) Guinier test Rg plot">
</center>
<p>

Likewise, plots of the approximate molecular weight calculations can be shown by pressing the <b><i>Approx. MW plot</b></i> button:<p>

<p><center>
<img SRC="somo-HPLC-SAXS_test_I_q_Guinier_MW_plot.png" ALT="SOMO HPLC-SAXS test I(q) Guinier test Rg plot">
</center>
<p>


Pressing <i><b>Test I(q)</i></b> button will bring back the main options of this utility.<p>

Pressing the <b><i>Cancel</i></b> button will exit the <b><i>Test I(q)</i></b> utility.<p>

If Gaussian analysis is not required, a series of <i>I(q)</i> vs. <i>q</i> frames can be re-created at this stage from the baseline-corrected data by pressing the <b><i>Make I(q)</i></b> button.<p>

<hr>
<hr>

Another new feature present in this release of the <b><i>US-SOMO HPLC-SAXS</i></b> module is an alternative way of estimating the errors associated with the SAXS data. This might become useful if no errors have been already associated with the experimental data, or if their reliability is questionable.<br>
The method is based on the assumption that the fluctuations of the signal at the baseline level are a good representation of the error associated with the data an any other point along each <i>I(t)</i> vs. <i>t</i> chromatogram. Therefore, by estimating the average fluctuations in flat regions of the chromatogram, a <b>constant</b> SD value can be associated with <b>every</b> datapoint in that particular chromatogram. Obviously, different chromatograms will have different values for their respective constant SD.<p>

Upon selecting a single <i>I(t)</i> vs <i>t</i> chromatogram, the actual SD associated with it can be visualized by selecting the <b><i>Err</i></b> checkbox in the <b><i>Data files</i></b> commands section, as shown in the image below:<p>

<p><center>
<img SRC="somo-HPLC-SAXS_errors1.png" ALT="SOMO HPLC-SAXS errors visualization">
</center>
<p>

By pressing the <b><i>SD eval.</b></i> button, two vertical red lines will be superimposed on the initial region of the chromatogram, and two red-background fields controlling their position will appear in the bottom row of the commands below the graphics window:<p>

<p><center>
<img SRC="somo-HPLC-SAXS_errors2.png" ALT="SOMO HPLC-SAXS SD evaluation initial image">
</center>
<p>

An additional checkbox, <i><b>2 regions</i></b>, if selected will duplicate the vertical lines and their associate fields (colored magenta this time), allowing to utilize more than one flat region for the SD estimation:<p> 

<p><center>
<img SRC="somo-HPLC-SAXS_errors3.png" ALT="SOMO HPLC-SAXS SD evaluation 2 zones">
</center>
<p>

The SD evaluation is carried out by fitting the data included between each zone with a 3<sup>rd</sup> degree polynomial, and taking the RMSD of the fit as the SD. If two regions are chosen, the final SD will be an average between the values computed from each region.<p>

After adjusting the zone(s)  for the SD evaluation, pressing <b><i>Keep</i></b> will accept the values, and the <b><i>SD apply</i></b> button becomes available. Pressing it will apply the SD calculation to any selected chromatogram. In the example below, the same chromatogram is plotted twice, with the old (salmon) and new (slate gray) SDs:<p>
<p>

<p><center>
<img SRC="somo-HPLC-SAXS_errors4.png" ALT="SOMO HPLC-SAXS SD evaluation 2 zones actual">
</center>
<p>

A blow-up of the main peak region highlights how the two SDs are very close to each other, demonstrating that the assumptions taken for this alternative SD evaluation produce SDs which are very similar to the ones that have been associated to the original SAXS data using a Poisson distribution. The main difference is that the original SDs vary slightly with the intensity for each <i>I(t)</i> vs. <i>t</i> chromatogram, while the baseline fluctuations method produces constant SD values for each <i>I(t)</i> vs. <i>t</i> chromatogram.<p>
<p>

<p><center>
<img SRC="somo-HPLC-SAXS_errors5.png" ALT="SOMO HPLC-SAXS SD evaluation zoom">
</center>
<p>

<hr>
<hr>
<p>
Gaussian decomposition of not baseline-resolved peaks is another utility present in the <b>US-SOMO <i>HPLC-SAXS</i></b> module. Decomposition with symmetrical Gaussian functions will be first described using a bovine serum albumin (BSA) SEC-SAXS run using two 7.8 &times; 300 mm ID columns packed with hydroxylated polymethacrylate particles (TSK G4000PWXL, 10 &micro;m size, 500 &Aring; pore size, and G3000PWXL, 6 &micro;m size, 200 &Aring; pore size, Tosoh Bioscience, Tokyo, Japan) connected in series, protected by a 6 &times; 40 mm guard column filled with G3000PW resin (Tosoh). The data presented capillary fouling evidence, and were thus subjected to Integral Baseline correction (not shown).<p>

<p><center>
<img SRC="somo-HPLC-SAXS_BSA_I_t.png" ALT="SOMO HPLC-SAXS BSA I(t) for symmetrical Gaussian decomposition">
</center>
<p>

Before proceeding to Gaussian analysis (whose theory can be seen <a href=saxs_hplc_Gaussian_theory.html>here</a>), a SVD analysis could be useful. In SVD analysis, the number of significant singular values in the decomposition should be equal to the number of components in the data, and thus to the minimum number of Gaussians required to accurately reconstruct the data (see <a href=somo_saxs_hplc_svd.html>here</a>).<p>

<p><center>
<img SRC="somo-HPLC-SAXS_Gauss1.png" ALT="SOMO HPLC-SAXS Gaussian initialization">
</center>
<p>

The baseline-subtracted data can be subjected to Gaussian analysis by first selecting a single chromatogram, and then pressing the <b><i>Gaussians</b></i> button. By default, the <b>US-SOMO <i>HPLC-SAXS</i></b> module will consider symmetrical Gaussians, but distorted Gaussian functions are also availble and can be selected from the <b><i>Options</b></i> menu (see <a href=saxs_hplc_options.html>here</a>). The choice must be done before starting the following procedure. An example of a data processing with non-symmetrical Gaussians is presented <a href=somo_saxs_hplc_skewedGauss.html><b>here</b></a>.<p>
On pressing <b><i>Gaussians</i></b>, two new rows will appear at the bottom of the graphics window. If a previously-generated set of Gaussians was present or loaded from file, the Gaussians will show up under the peak(s) together with vertical lines indicating their centers.<p>

<b><i>Clear</i></b> will remove currently-generated Gausssian, and allow to start a new analysis. If Gaussians had been loaded from file, the <i><b>Clear cached Gaussian values</i></b> button in the <a href=saxs_hplc_options.html><b><i>Options</i></b></a> menu should be used.<p>

Each time the <b><i>New</i></b> button is pressed, a new Gaussian will be added (green colour), with pre-set center, width and amplitude shown in the three rightmost fields (additional fields will be present if distorted Gaussians functions are used; see <a href=somo_saxs_hplc_skewedGauss.html>here</a>). By clicking on each field, and then using the gray-shades bar-wheel, each Gaussian can be adjusted to initialize the process (usually, only the centers need to be positioned under the peaks). If the <i>Match</i> checkbox is selected, the height of each Gaussian will be automatically adjusted so to match the height of the experimental <i>I</i>(<i>t</i>) vs. <i>t</i> curve at the Gaussian current position.<p>

<b><i>Del</i></b> will remove only the current Gaussian.<p>

Clicking on the "<b>&lt;</b>" and "<b>&gt;</b>" buttons will toggle among the Gaussian present, whose identifying number is shown in the field between them. The active Gaussian is identified by a magenta vertical line positioned at its center, while blue lines are used for the others. The limits for the analysis of the chromatogram are shown with two vertical red bars, whose position is shown in the two red-background fields in the bottom row, before the <b><i>To produced data</i></b> button.<p>

The <i>SD</i> checkbox controls whether the data associated std. dev. values will be used in the fitting procedure (<b><i>default: not selected</i></b>). It is recommended to select this checkbox only after a first round of fitting with the various algorithms provided has been performed, as the SD can only be used with the LM algorithm at the time of writing this Help section (April 2016).<p>

Once the initialization is completed, pressing the <b><i>Fit</i></b> button will bring up a window controlling the fit procedure, shown below:<p>

<p><center>
<img SRC="somo-HPLC-SAXS_GaussFit.png" ALT="SOMO HPLC-SAXS Gaussian Fit panel">
</center>
<p>

See <a href=somo_saxs_hplc_fit.html>here</a> for a description of the <b><i>Fit</b></i> module.<p>

In the first cycle of iterations, it is best to keep the original centers fixed:<p>

<p><center>
<img SRC="somo-HPLC-SAXS_Gauss1a.png" ALT="SOMO HPLC-SAXS Gaussian first round center fixed">
</center>
<p>

In the example shown, a not well-defined aggregates peak is present at the beginning, and an extended initial baseline is not present. If the first Gaussian is left free to adjust, it will expand too much to compensate for the missing initial baseline. Therefore, in such situations it is best to keep fixed the position of the first Gaussian:<p>

<p><center>
<img SRC="somo-HPLC-SAXS_Gauss1b.png" ALT="SOMO HPLC-SAXS Gaussian first round center fixed">
</center>
<p>

A final round of fitting can then be performed using the SD and allowing a 5% variation on the Gaussian centers at each iteration, until a satisfactory fit of the main peak(s) is obtained:<p>

<p><center>
<img SRC="somo-HPLC-SAXS_Gauss2.png" ALT="SOMO HPLC-SAXS Gaussian initial fit">
</center>
<p>

If some datasets have missing or NaN values for one or more SD values, a pop-up menu will appear listing all the files presenting this problem, and with how many occurrences. The user can then select between three options: drop the datasets containing these non-defined SDs; drop just the frame (or time) point missing the SD(s); or not use SD weighting.<p>

The global improvement of the fit can be also judged by the rmsd (<i>SD</i> checkbox not selected) or &chi;<sup>2</sup> (<i>SD</i> checkbox selected) value which is updated next to the <b><i>Fit</b></i> button. The residuals of the fit can be visualized by pressing the <b><i>Residuals</i></b> button, which will split the graphics window in two, and show a plot of the fit residuals below the main plot. The residuals plot can be removed by pressing <b><i>Residuals</i></b> again (see more below). In the example shown above, the residuals are weighted by the std. dev. associated with the experimental points (<i>SD</i> checkbox selected; a <i>By percent</i> residuals option is also available). <p>

Once a satisfactory fit is reached, pressing <b><i>Keep</i></b> will accept the current Gaussians for further work. But to save the parameters of the current Gaussians in a file, the <b><i>Save</i></b> button has to be pressed before <b><i>Keep</i></b>.<p>

<b><i>Cancel</i></b> will cancel the operations and remove all the Gaussians.<p>

Once an initial set of fitted Gaussians has been produced, it should be globally fitted to all chromatograms. However, performing this operation directly on all chromatograms can be very computationally intensive. For this reason, it is best to perform it on a subset of all chromatograms, and the global fit results are then propagated to all remaining chromatograms. <span style="color:#CC0000"><b>Importantly</b></span>, in the global fitting procedure the centers and widths of each particular Gaussian are optimized so to be the same across all chromatograms, and only the amplitudes are then fitted.<p>

To select a subset of data, the <b><i>Select</i></b> button is pressed, which will open the pop-up selection panel (see image below and <a href=saxs_hplc_nth.html>here</a>).

<p><center>
<img SRC="somo-HPLC-SAXS_GaussSelect.png" ALT="SOMO HPLC-SAXS Global Gaussian Nth selection">
</center>
<p>

It is advisable to perform the global fitting avoiding the very first few low-<i>q</i>, very noisy, and the last high-<i>q</i>, very low signal <i>I</i>(<i>t</i>) vs. <i>t</i> chromatograms. In the example we are illustrating, we start from chromatogram # 8 (<i>q</i> = 0.007813 &Aring;<sup>-1</sup>) and select every 4 chromatograms up to # 454 (<i>q</i> = 0.12020 &Aring;<sup>-1</sup>). The <i>I</i>(<i>t</i>) vs. <i>t</i> chromatogram on which the initial set of Gaussians was optimized is also included (<i><b>Select Additionally</i></b> button). Pressing <b><i>Transfer selection to main window</i></b> will close the pop-up window and the selected files will be shown in the main <b><i>HPLC-SAXS</i></b> module graphics window:<p>

<p><center>
<img SRC="somo-HPLC-SAXS_Gauss3a.png" ALT="SOMO HPLC-SAXS Global Gaussian on Nth">
</center>
<p>

The <b><i>Global Gaussians</i></b> button is now available. This utility has two main usages. During the search for the best Gaussians parameters, it will find the amplitudes best fitting all the selected chromatograms based on the centres and widths found on the initial chromatogram. This operation has to be performed before the global fit. It will allso restore the saved parameters saved in a file after a satisfactory fitting is attained. For this reason, on pressing the <b><i>Global Gaussians</i></b> button, a pop-up panel will appear:

<p><center>
<img SRC="somo-HPLC-SAXS_GlobalGaussianOptions.png" ALT="SOMO HPLC-SAXS Global Gaussians mode: fit amplitudes or restore saved ones">
</center>
<p>
In this case, the answer is <i>Yes</i>, and the amplitudes will be set for all the selected chromatograms.<p>

If datasets having points with missing or NaN std. dev. values are found, another pop-up panel will appear:<p>

<p><center>
<img SRC="somo-HPLC-SAXS_Drop0SD.png" ALT="SOMO HPLC-SAXS Drop 0 SD pop-up">
</center>
<p>

When just a few problematic points are found for each chromatogram, the <i>Drop points with 0 SDs</i> option can be safely used. The global Gaussians operation will then be completed:<p>

<p><center>
<img SRC="somo-HPLC-SAXS_Gauss3.png" ALT="SOMO HPLC-SAXS Global Gaussian on Nth final">
</center>
<p>

In the image above, the <b><i>Global Gaussians</i></b> results on the <b><i>Nth</i></b> selected files are shown, together with the grouped fit residuals. The common centers and widhts, <span style="color:#CC0000">not optimized but just based on the initial chromatogram fit</span>, are displayed in the graph as vertical and horizontal bars, respectively. Note that the <i>Residuals</i> plot <i>x</i>-axis scale was manually optimized (right-click on the scale) to make it comply with the fit limits in the top panel.<p>

<b><i>Save</i></b> will save the resulting Gaussians to the current selected directory, with extension -gauss.dat for symmetrical Gaussians of single files and -mgauss.dat for Gaussians of multiple files. For distorted Gaussians, the extensions will be -mgmg.dat, -memg.dat, and -memggmg.dat for the GMG, EMG and EMG+GMG Gaussians, respectively.<p>

<b><i>Global fit</i></b>, which becomes available instead of the <b><i>Fit</i></b> button once a series of chromatogram is selected and after at least an initial set of Gaussians is generated/loaded, can now be used to optimize all the centres and widths of each Gaussian along all the chromatograms to common values for each family of Gaussians. The operation is controlled by the same pop-up <b>Fit</b> panel as for the single chromatogram case (see <a href=somo_saxs_hplc_fit.html>here</a>), but only the LM method is currently (April 2016) available. In this example, it is best to first perform a global fit round keeping the Gaussians 1, 2 and 4 fixed, and then perform a second round leaving all parameters free.<p>

<p><center>
<img SRC="somo-HPLC-SAXS_Gauss4.png" ALT="SOMO HPLC-SAXS Gaussian Global fit">
</center>
<p>

In the image above, the results of the <b><i>Global fit</i></b> are shown together with the grouped fit residuals. Furthermore, a new set of tools is available to judge the goodness of the fit.<p>

<ul>
<li>
A pairwise <b>CorMap</b> analysis in automatically performed between each original <i>I</i>(<i>t</i>) vs. <i>t</i> chromatogram and its reconstruction based on the sum of the fitting Gaussians, for each <i>q</i>- value.<p>

<li>
A new kind of plot becomes available, visualized by pressing <b><i>Global fit by q</i></b>. The normalized &chi;<sup>2</sup> (diamonds connected by a line) and the pairwise CorMap <i>P</i>-values (squares) are plotted as a function of the <i>q</i>-value, as shown below:<p>
</ul>

<p><center>
<img SRC="somo-HPLC-SAXS_Gauss4b.png" ALT="SOMO HPLC-SAXS Gaussian Global fit with Global fit by q">
</center>
<p>

In the <i>Global fit by q</i> graph it is possible to visualize either one of or both the two plots, by selecting/deselecting their respective checkboxes positioned just below it (<i>Plot Chi^2/RMSD</i> and <i>Plot CorMap P values</i>). Note that in the image above, where both plots are shown, their respective <i>y</i>-axis scales have been manually modified to allow a better visualization of each plot. The dashed green and yellow horizontal lines mark the usual cut-off <i>P</i>-values (<i>P</i> &ge; 0.05, above the green line; 0.05 &gt; <i>P</i> &gt; 0.01 between the green and yellow lines; <i>P</i> &lt; 0.01, below the yellow line).<p> 

Note that the limits of the fit have been moved to exclude the first peak and the tail of the main peak. This was done to concentrate the goodness-of-fit indicators toward the most important part of the fit, including the top (2/3)<sup>rds</sup> of peaks 2, 3 and 4 (each time the limits are moved, the normalized &chi;<sup>2</sup> and <i>P</i>-values are recomputed by pressing the <b><i>Recompute nChi^2</i></b> button). With these limits, the normalized &chi;<sup>2</sup> values display "reasonable" values, &asymp;1.5 for the lowest <i>q</i> angles (up to <i>q</i> &asymp;0.035 &Aring;<sup>-1</sup>), then almost linearly decaying to &asymp;0.5 for <i>q</i> &asymp;0.8 &Aring;<sup>-1</sup>, being stable afterwards, for a global &chi;<sup>2</sup> &asymp;0.95. Likewise, the CorMap <i>P</i>-values show a slight trend toward better values as the <i>q</i> increases, but the distribution of really "bad" <i>P</i>-values appears to be substantially random.<p> 

The correlation between the goodness-of-fit indicators and the distribution of the residuals can be examined for each original/fit <i>I</i>(<i>t</i> vs. <i>t</i> pair by selecting the <i>Scroll</i> checkbox:<p>

<p><center>
<img SRC="somo-HPLC-SAXS_Gauss4c.png" ALT="SOMO HPLC-SAXS Gaussian Global fit">
</center>
<p>

In the image above, only the CorMap <i>P</i>-value are shown. The current chromatograms pair is highlighted in the CorMap <i>P</i>-values plot by an enlarged symbol (orange square in this case). Scrolling is performed by either using the grey-scale bar-wheel, or by clicking on the the "<b><i>&lt;</i></b>" and "<b><i>&gt;</i></b>" buttons placed at its sides. By selecting/deselecting the three checkboxes next to the <i>Scroll</i> checkbox
(<i>P >= 0.05</i>, <i>0.05 > P >= 0.01</i>, <i>P < 0.01</i>), only the subset(s) whose <i>P</i>-values are within those of the selected chechbox(es) will by scrolled.<p>

In the example shown above, by examining the residuals' plot it is clear that the "bad" <i>P</i>-value it is due to a poor fit in the inflection point betweern the 3<sup>rd</sup> and 4<sup>th</sup> peaks. If we examine a chromatograms pair just two <i>q</i> values above the first one examined in detail, we can see that oscillations in this zone produce an excellent <i>P</i>-value, although this still appears to be a difficult zone to fit with symmetric Gaussians:<p>

<p><center>
<img SRC="somo-HPLC-SAXS_Gauss4d.png" ALT="SOMO HPLC-SAXS Gaussian Global fit">
</center>
<p>

The noticeable worse fitting and the end of the main peak could indicate either a slight non-pure Gaussian shape of the peak, or the presence of a small amount of some trailing material in this region.<p>

It is best to first <b><i>Save</i></b> and then <i><b>Keep</i></b> the results, and then select all the available <i>I(t)</i> vs. <i>t</i> chromatograms (use <b><i>Select all</i></b> if only <i>I(t)</i> vs. <i>t</i> data are present in the <b>Data files</b> section).<p>

<b><i>Global Gaussians</i></b> can now be applied to all the selected chromatograms. Again, a pop-up panel will appear:

<p><center>
<img SRC="somo-HPLC-SAXS_GlobalGaussianOptions.png" ALT="SOMO HPLC-SAXS Global Gaussians mode: fit amplitudes or restore saved ones">
</center>
<p>
Also in this case, the answer is <i>Yes</i>, and the amplitudes will be set for all the selected chromatograms.<p> Again, if datasets having points with missing or NaN std. dev. values are found, a pop-up panel will appear (not shown).<p>

<p><center>
<img SRC="somo-HPLC-SAXS_Gauss5.png" ALT="SOMO HPLC-SAXS Global Gaussian Global on all">
</center>
<p>

The image above shows the global Gaussians results after applying the global fit parameters found on a subset of data to all chromatograms. Note that in the series of graphs above, the residuals <i>x</i>-axis was rescaled (using the graph controls accessed by right-clicking on the graphics window plots) to align it with the selected fit region delimited by the two red vertical lines.<p>

<b><i>Save</i></b> and <i><b>Keep</i></b> can then be sequentially pressed to store and accept the global Gaussian results.<p>


Pressing the <b><i>3D</i></b> button will generate a 3D plot of the data, allowing easier detection of potential fitting issues. First a pop-up window will appear:<p>

<p><center>
<img SRC="somo-HPLC-SAXS_Gauss_3D_selector.png" ALT="SOMO HPLC-SAXS 3D plot Gaussians selector">
</center>
<p>

More infos about this small module can be found <a href=saxs_hplc_p3d.html>here</a>.<p>

<p><center>
<img SRC="somo-HPLC-SAXS_Gauss6.png" ALT="SOMO HPLC-SAXS 3D plot of Global Gaussians">
</center>
<p>

This interactive plot can show any selected set of the Global Gaussians over any collection of curves. The interface is fully interactive for rotations, scaling and zooming along with multiple display and save controls. Its utilization is helpful for visualizing the quality of the global fit.<p>


<span id="trialmakeiq">After Gaussian decomposition, the <b><i>Trial make I(q)</b></i> procedure can be repeated. First, all the available <i>I</i>(<i>t</i>) vs. <i>t</i> chromatograms for which Gaussians have been produced are selected, and the <b><i>Trial make I(q)</b></i> button is pressed. The third commands row under the graphics window will now show additional options:<p></span>

<p><center>
<img SRC="somo-HPLC-SAXS_Gauss_test_I_q.png" ALT="SOMO HPLC-SAXS Test I(q) after Global Gaussians decomposition">
</center>
<p>

The round checkboxes labeled <i>none</i>, <i>1</i>, <i>2</i>, <i>3</i>, and <i>4</i> allow selecting which Gaussian will be used to produce the corresponding decomposed <i>I</i>(<i>q</i>) vs. <i>q</i> data, as a pointwise % of the original <i>I</i>(<i>t</i>) vs. <i>t</i> data based on the relative contribution of <span style="color:#CC0000">all</span> Gaussians at that particular point in <i>t</i> space. If the square <i>as pure Gaussian</i> checkbox is selected, the actual Gaussian value will insted be used (effectively smoothing the data).<p>

In the first example shown below, the <i><b>Rg plot</i></b> for the region of the main peak using the 4<sup>th</sup> Gaussian can be seen:<p>

<p><center>
<img SRC="somo-HPLC-SAXS_Gauss_test_I_q1.png" ALT="SOMO HPLC-SAXS Test I(q) after Global Gaussians decomposition G4 main peak">
</center>
<p>

The contribution of the 3<sup>rd</sup> Gaussian under the main peak can be now evaluated:<p>

<p><center>
<img SRC="somo-HPLC-SAXS_Gauss_test_I_q2.png" ALT="SOMO HPLC-SAXS Test I(q) after Global Gaussians decomposition G3 main peak">
</center>
<p>

As can be seen, there is a slight contribution (see the &#126;500-fold reduction in intensity in the Guinier plot) from the peak preceeding the main peak, evidenced by the fairly constant but considerably higher <i>R<sub>g</sub></i> values (&#8776; 44.5 &Aring;), likely identifying this material as a BSA dimer (also confirmed by the average MW[RT] value).<br>
If we perform this analysis selecting the top region of the dimer peak (frames 72-90), we find similar <i>R<sub>g</sub></i> values, &#8776; 43.7 &Aring;, almost evenly distributed across the peak:<p>

<p><center>
<img SRC="somo-HPLC-SAXS_Gauss_test_I_q3.png" ALT="SOMO HPLC-SAXS Test I(q) after Global Gaussians decomposition G3 dimer peak">
</center>
<p>


Note that some of the curves present an upward curvature at low <i>q</i>-values, likely indicating a non-ideal baseline correction for this sample.<br>
Finally, the contribution of the 2<sup>nd</sup> Gaussian under the trimer peak is evaluated:<p>

<p><center>
<img SRC="somo-HPLC-SAXS_Gauss_test_I_q5.png" ALT="SOMO HPLC-SAXS Test I(q) after Global Gaussians decomposition G2 trimer peak">
</center>
<p>

finding higher <i>R<sub>g</sub></i> values (&#8776; 60 &Aring;) and a reasonably flat distribution. <p>

The <b><i>Scroll</b></i> feature is also available, allowing the examination of the individual Guinier plots. Likewise, the <b><i>Approx. MW plot</b></i> can show the approximate molecular weight values calculated with the Rambo and Tainer method (Accurate assessment of mass, models and resolution by small-angle scattering. Nature 496:477-481, 2013) . However, as it requires to produce meaningful results a more extended <i>q</i> range than that available for the HPLC-SAXS BSA study presented here, we will not present such plots here.<p> 

<hr>

Each individual Gaussian is defined by three numbers: the amplitude, width and center. As such, they are not "curves" in the sense of the loaded files, which are collections of data points. Therefore, the Gaussians can not be visualized with the facilities of the program outside of Gaussian or Global Gaussian modes.<p>

To allow the visualization of the Gaussians, the <b><i>To produced data</i></b> button is provided which produces curves of individual Gaussians and their sum. This is available in either Gaussian or Global Gaussian modes. The resulting curves are collections of data points that can be visualized outside of the Gaussian modes. The Global Fit method requires a simultaneous fit of all the selected curves. This is internally represented by joining all the selected curves along the time/frame dimension to produce one long curve. Of course, each curve is generally on the same time/frame axis range, so to maintain increasing time/frame numbers, curves subsequent to the first one are placed into the joined curve with an offset in time/frame.<p>

<p><center>
<img SRC="somo-HPLC-SAXS_Gauss8.png" ALT="SOMO HPLC-SAXS Joined result curves and original data">
</center>
<p>


To visualize the joined curve and the Global Gaussian fit to the joined curve the <b><i>Make result curves</i></b> button is provided. This will create the joined curve along with the joined Global Gaussian fit as a pair of curves that can be visualized outside of the Global Gaussian mode, as in the example shown below:<p>

<p><center>
<img SRC="somo-HPLC-SAXS_Gauss8a.png" ALT="SOMO HPLC-SAXS Joined result curves and original data">
</center>
<p>

<hr>
<hr>

If available, a concentration chromatogram deriving from UV or refractive index monitors can now be processed. After uploading a suitable file with the <b><i>Concentration load</i></b> button:<p>

<p><center>
<img SRC="somo-HPLC-SAXS_Conc_chrom.png" ALT="SOMO HPLC-SAXS Concentration Chromatogram">
</center>
<p>

the first operation is to rescale it to one of the high intensity but relatively low-noise <i>I(t)</i> vs. <i>t</i> chromatograms. This is done by selecting the two files:<p>

<p><center>
<img SRC="somo-HPLC-SAXS_Conc_chrom1.png" ALT="SOMO HPLC-SAXS Concentration Chromatogram and target file">
</center>
<p>

and pressing <b><i>Repeak</i></b> in the left-side command panel, which will bring up a small window asking to identify the target chromatogram (in case multiple were selected).<p>

<p><center>
<img SRC="somo-HPLC-SAXS_Conc_chrom2.png" ALT="SOMO HPLC-SAXS Target Chromatogram selection">
</center>
<p>

Usually concentration detector data have no associated SDs. In this case, another pop-up panel will appear presenting three options:<p>

<p><center>
<img SRC="somo-HPLC-SAXS_Conc_chrom3.png" ALT="SOMO HPLC-SAXS SD options in repeak">
</center>
<p>

<ul>
<li>
<i>Ignore S.D.s</i>.<p>

<li>
<i>Match target S.D. % pointwise</i>; this will generate artificial SDs data associated with the concentration detector data matching %wise and pointwise the SDs present in the target <i>I(t)</i> vs. <i>t</i> data.<p>

<li>
<i>Set S.D.s to 5%</i>; this will generate artificial SDs data at a 5% level associated with the concentration detector data.<p>
</ul>

Selecting the second option will allow a consistent Gaussian analysis of the concentration detector data.<p>

The repeak operation is then automatically performed, and another pop-up message will appear:

<p><center>
<img SRC="somo-HPLC-SAXS_Conc_chrom3a.png" ALT="SOMO HPLC-SAXS SD associate repeaked">
</center>
<p>

If no time-shift between the concentration and the SAXS detectors is present, the repeaked concentration file can then be directly associated with the SAXS datasets. Otherwise, it is better to perform first the timeshift operation (see below) before setting the concentration file. The result of a re-peak operation is shown below, and the scaling factor is added to the concentration dataset filename.<p>

<p><center>
<img SRC="somo-HPLC-SAXS_Conc_chrom4.png" ALT="SOMO HPLC-SAXS Conc. Chromatogram Repeaked">
</center>
<p>


After re-peaking, the concentration chromatogram usually must be time-shifted to align its peaks to the <i>I(t)</i> vs. <i>t</i> chromatograms using the <b><i>Timeshift</i></b> button.<p>

Again, at least two files must be selected, one is the concentration data, the other belonging to the <i>I(t)</i> vs. <i>t</i> (the file used for re-peaking is normally used for this operation). 

An automatic alignment is first performed, using the highest intensity peaks. The alignment can then be refined manually by left-clicking and moving the mouse over the grey-shades wheel bar below the graphics window until the two chromatograms are best aligned.<p>

<p><center>
<img SRC="somo-HPLC-SAXS_Conc_chrom6.png" ALT="SOMO HPLC-SAXS Conc. Chromatogram Timeshift select">
</center>
<p>

The value of the timeshift is reported in the field next to the grey-shades wheel bar.<p>

<b><i>Cancel</i></b> will stop the operation.<p>

<b><i>Keep</i></b> will keep the time-shifted data. The produced data will have the timeshift value added to its filename on saving.<p>

Another pop-up panel will appear, asking to associated the time-shifted concentration file to the SAXS data:

<p><center>
<img SRC="somo-HPLC-SAXS_Conc_chrom5a.png" ALT="SOMO HPLC-SAXS Conc. Chromatogram Timeshift associate panel">
</center>
<p>

Answering "yes" will then associate the re-peaked, time-shifted concentration data to the <i>I(t)</i> vs. <i>t</i> SAXS dataset under analysis. This operation can be anyway performed at any time by selecting only a concentration chromatogram dataset, and pressing <b><i>Set</i></b>. The concentration chromatogram shown in this example is then cropped to have approximately the same frame number as the SAXS <i>I</i>(<i>t</i>) vs. <i>t</i> chromatograms.<p>

The re-peaked, time-shifted concentration chromatogram can be now fitted with Gaussians, using for initialization the set derived from the <i>I(t)</i> vs. <i>t</i> chromatograms (note: it is mandatory that the same number of Gaussians be used for both the concentration and <i>I(t)</i> vs. <i>t</i> chromatograms).<p>

This is done by first selecting only the concentration chromatogram and then pressing <b><i>Gaussian</i></b>, which will bring up the current Gaussian parameters automatically rescaled to the highest intensity in the concentration chromatogram:<p> 

<p><center>
<img SRC="somo-HPLC-SAXS_Conc_chrom7.png" ALT="SOMO HPLC-SAXS Conc. Chromatogram initial Gaussians">
</center>
<p>

Pressing <b><i>Fit</i></b> will then bring up the <b>Fit</b> window (see <a href=somo_saxs_hplc_fit.html>here</a>) and an initial round is done by keeping fixed both the position and widths. If necessary, a refinement can be done by keeping fixed the smallest, front eluting peak(s), and allowing only a limited shift to a % of the initial values from the widths and positions determined from the SAXS data (suggested: 2-3% max). This should compensate for slight misalignment between the concentration and SAXS detectors chromatograms.<p>

<p><center>
<img SRC="somo-HPLC-SAXS_Conc_chrom8.png" ALT="SOMO HPLC-SAXS Conc. Chromatogram final Gaussians">
</center>
<p>

As evidenced in the image above, some band broadening has occurred between the UV-VIS and SAXS detectors. While the issue appears to be relatively minor here, it can be more serious. To at least partially mitigate this issue, we have implemented a re-shaping routine that re-aligns the shape of the concentration detector chromatogram to that of the SAXS detector chromatograms. It is based on determining first the area under each Gaussian peak in the concentration chromatogram after fitting it with the SAXS-derived Gaussians with minimal centers and widths changes, as described above. Then, when the <b><i>Make I(q)</i></b> routine is launched, the concentration chromatogram Gaussians can be optionally re-shaped on the SAXS-optimized Gaussians, keeping their areas fixed and adjusting the other parameters (see below).<p>

The <b><i>Save</i></b> and <b><i>Keep</i></b> buttons must be then pressed to store and associate the resulting Gaussians to the concentration chromatogram. On re-generating the <i>I(q)</i> vs. <i>q</i> frames (see below), each concentration Gaussian peak will be mapped onto the corresponding <i>I(t)</i> vs. <i>t</i> peaks.<p>

The <b><i>Make I(q)</i></b> button becomes available every time that more than one <i>I</i>(<i>t</i>) chromatogram is selected. If Gaussian fitting was performed, pressing it will produce a series of <i>I(q)</i> vs. <i>q</i> curves for each Gaussian peak for each frame of the chromatogram on which the global operations have been carried out. An option panel in a pop-up window will allow several choices:

<p><center>
<img SRC="somo-HPLC-SAXS_Make_Iq.png" ALT="SOMO HPLC-SAXS Make I(q)">
</center>
<p>

A description of this module can be found <a href=saxs_hplc_ciq.html>here</a>.<p>

Once the <i>I(q)</i> vs. <i>q</i> files have been generated, it is possible to view the resulting Gaussian contributions and their sum, as shown below:<p>

<p><center>
<img SRC="somo-HPLC-SAXS_Gauss9.png" ALT="SOMO HPLC-SAXS resulting I(q)s">
</center>
<p>

Here the original and decomposed <i>I(q)</i> for frame #59 (cream), originally presenting an overlap between the trimers and dimers peaks, are shown, together with the reconstructed sum with baseline back-addition (see the legend for details). The drop of intensity at <i>q</i> values > 0.07 &Aring;<sup>-1</sup> for Gaussian peak #1 (purple) is due to its contribution vanishing in the high <i>q</i> range. Note how there is a contribution from Gaussians #1, #2 (orange), and #3 (olive green) in this frame (peak #4, not contributing at all in this frame, is not shown). Note also how the reconstructed curve with baseline back-addition (whose color would be cyan) perfectly superimposes with the original frame data (cream), and thus is almost not visible in this frame except at the very end of the <i>q</i> range.<p>

A zoom into the low <i>q</i> region for frames #75-86 of the Gaussian peak #3 it is shown in the next two images, before and after concentration normalization (<b><i>Normalize</i></b> button):<p>

<p><center>
<img SRC="somo-HPLC-SAXS_Gauss10.png" ALT="SOMO HPLC-SAXS resulting I(q)s">
</center>
<p>
<p>
<p><center>
<img SRC="somo-HPLC-SAXS_Gauss11.png" ALT="SOMO HPLC-SAXS resulting I(q)s">
</center>
<p>
In the latter, an average curve (obtained by pressing the <b><i>Average</i></b> button) is also superimposed. Such re-generated <i>I(q)</i> vs. <i>q</i> data can be directly exported in the main <b>US-SOMO <i>SAS</i></b> module for further operations by pressing the <b><i>To SOMO/SAS</i></b> button.<p>
Note that starting from the January 2018 release, an automatic selector of frames to be averaged has been introduced within the <b><i>Make I(q)</i></b> option panel (see <a href=saxs_hplc_ciq.html>here</a>). This option will also normalize each frame by its associated concentration value, if present, before performing the average.
<p>

If a concentration chromatogram is associated with the data, an additional utility present in this module allows to map a single selected <i>I(q)</i> vs. <i>q</i> dataset onto the concentration chromatogram, by pressing the <b><i>Concentration reference</i></b> button:<p> 

<p><center>
<img SRC="somo-HPLC-SAXS_conc_ref.png" ALT="SOMO HPLC-SAXS concentration refrence">
</center>
<p>

In the example shown above, the <i>I(q)</i> vs. <i>q</i> data for the decomposed peak #3 frame #80 are shown with their associated errors, and below it the position of this dataset is shown by the vertical red line on the associated concentration cromatogram. Each time a different chromatogram is selected, its position will be mapped on the concentration plot.<br>
Pressing the <b><i>Concentration reference</i></b> button again will make this additional plot disappear.<p>
<p>
Finally, the data shown in any of the plots currently visualized can be saved in csv-formatted files by pressing the <b><i>Save plots</i></b> button. This will open a pop-up dialogue window where the location and the root filename for the cvs files can be set.<p>

<p>

<p>
<hr>
<font face="helvetica" size="-1">
www contact: <a href="mailto:brookes@uthscsa.edu">Emre Brookes</a>
</font>
<p>
<font face="helvetica" size="-1">
This document is part of the <i><b>UltraScan</b></i> Software Documentation
distribution. <br><a href=copyright.html>Copyright &copy; notice</a>.<br><br> The latest version of this document can always be found at:
</font>
<p>
<font face="helvetica" size="-1">
<a href="http://somo.aucsolutions.com">http://somo.aucsolutions.com</a>
</font>
<p>
<font face="helvetica" size="-1">
Last modified on June 29, 2022.
</font>
</body>
</html>
