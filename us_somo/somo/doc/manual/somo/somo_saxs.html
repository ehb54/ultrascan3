<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
   "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<meta content="text/html;charset=ISO-8859-1" http-equiv="Content-Type">
	<title>SOMO SAXS/SANS (SAS) Simulation Module</title>
	<link href="mainstyle3.css" rel="styleSheet" type="text/css">
</head>
<body>
<table BORDER=0 CELLPADDING=5 >
<tr>
<td><img SRC="USSOMO-banner.png" BORDER="0" ALT="UltraScan Version"> </td>
<td>
<center>
<h1>
<i>Manual</i></h1></center>
</td>
</tr>
</table>

<hr>
<center>
<h2>
SOMO - SAXS/SANS (SAS) Simulation Module:</h2>
<p>
<p>
<h3><center>Last updated: March 2023 </center></h3><p>
<center><span style="color:#CC0000">NOTICE: portions of this help file are taken from the Supplementary Materials of "Brookes et al. Fibrinogen species as resolved by HPLC-SAXS data processing within the UltraScan SOlution MOdeler (US SOMO) enhanced SAS module," J. Appl. Cryst., 46:1823-1833 (2013).</span>
</center>
<p>
<img SRC="somo-SAXS_SANS_new1.png" ALT="SOMO SAXS Simulation Screen">
</center>
<p>
Small-Angle X-ray or Neutron Scattering (SAXS or SANS) <i>I</i>(<i>q</i>) vs. <i>q</i> curves, and pairwise distance distribution
curves <i>P</i>(<i>r</i>) vs. <i>r</i>, can be generated by this  module from either a PDB file or a bead model. Additionally, <i>P</i>(<i>r</i>) curves can be generated via the <a href=saxs_ift.html>indirect Fourier transform</a> from an experimental <i>I</i>(<i>q</i>) curve. In the above screenshot, an experimental Human Serum Albumin (HSA) SAXS curve (collected at the Synchrotron SOLEIL SWING beamline in 2012) is shown in the top right panel (yellow circles with error bars), overlaid with the back-calculated <i>I</i>(<i>q</i>) vs. <i>q</i> curve (green) after the IFT generation of the <i>P</i>(<i>r</i>) vs. <i>r</i> shown as the yellow curve in the bottom-right panel, overlaid with the <i>P</i>(<i>r</i>) vs. <i>r</i> calculated from the completed 1AO6.pdb monomer A structure (green curve).<p>

The module window is accessed from the <b>US-SOMO</b> main window by pressing the <b><i>SAXS/SANS Functions</i></b> button. If either a PDB or a bead model file are loaded in the <b>US-SOMO</b> main window, it will be automatically exported to the <b>SAXS/SANS module</b>, and listed in the <i>PDB Filename</i> (alternatively, <i>Bead Model Filename</i>) field. If no files were selected in the main <b>US-SOMO</b> window, this field will be empty.<p>
In order to properly compute the  <i>I</i>(<i>q</i>) vs. <i>q</i> and <i>P</i>(<i>r</i>) vs. <i>r</i> curves, the module utilizes the  <a href="somo-2.png">atom definition</a> (default: <i>somo.atom</i>), <a href="somo-hybrid.png">hybridization</a> (default: <i>somo.hybrid</i>) and <a href="somo-saxs_coeff1.png">SAXS coefficients</a> (default: <I>somo.saxs_atoms</i>) tables. Different tables can be selected by pressing the <b><i>Load Atom Definition File</i></b>, <b><i>Load Hybridization File</i></b>, and <b><i>Load SAXS Coefficients File</i></b> buttons. See the <a href="somo.html">main help</a> for further explanations on the content and use of these tables.<p>

The <b>SAS module</b> panel is divided in two sections, <b><i>SAS I(q) Plotting Functions:</i></b> and <b><i>P(r) vs. r Plotting Functions:</i></b>, which can operate indipendently, each one with its graphics window. Clicking on each windows' label will make all the fields below it disappear, and the graphic window will consequently expand. The panels can be restored by clicking again on their labels.<p>
<hr>
<center>

<p>
<img SRC="somo-SAXS_SANS_Iq_panel_new.png" ALT="SOMO SAS I(q) Simulation Panel">
</center>
<p>

<b><i>SAS Plotting Functions:</i></b>
The first series of buttons in the "SAS I(q) Plotting Functions" section deals with operations on previously computed or experimental data.<br>
<ul>
<li>
Loading is done with the <b><i>Load SAXS (SANS)</i></b> button (the SAXS/SANS label will switch depending on whether SAXS or SANS operations have been chosen, see below). If one or more curves are already present in the graphics window, rescaling of the new entry is possible by selecting the target curve in a pop-up window. Starting with the <span style="color:#CC0000">July 2022 intermediate release</span>, multiple entries can be selected for loading. If no previous file had been uploaded, the multiple selections will not be scaled, otherwise a reference dataset for scaling can be chosen.<br>
Besides our own data formats, including multiple datasets in a comma-separated variable (csv) format (see <a href=somo_saxs_load_csv.html>here</a>), the Crysol/Cryson format (Svergun et al., J. Appl. Cryst. 28, 768-773, 1995; Svergun et al., Proc. Natl. Acad. Sci. USA, 95, 2267-2272, 1998) is also recognized. Pressing <b><i>Load SAXS (SANS)</i></b> will open up a panel listing previously utilized directories where the appropriate file might be found:  
<center>
<p>
<img SRC="somo-SAXS_SANS_Previous_Directories_new.png" ALT="SOMO SAXS I(q) Previous Directories">
</center>
<p>
<center>
<p>
<img SRC="somo-SAXS_SANS_File_types_new.png" ALT="SOMO SAXS I(q) File tipes">
</center>
<p>
Once a file has been selected (see above for a list of compatible file types), the curve will be displayed in the top-right interactive graphics window:
<center>
<p>
<img SRC="somo-SAXS_SANS_SAXS_curve.png" ALT="SOMO SAXS I(q) Expt. SAXS curve example">
</center>
<p>
Portions of the graphs can be zoomed in by selecting them with the mouse while pressing the left button:
<center>
<p>
<img SRC="somo-SAXS_SANS_SAXS_curve1.png" ALT="SOMO SAXS I(q) Expt. SAXS curve zoom example">
</center>
<p>
The top horizontal and right vertical scroll bars allow the visualization of other portions of the graph at the actual zoom level. Right-clicking with the mouse on the graph will restore the full scaling of the graph. Right-clicking on the graph frame will instead open an interactive panel for setting overall graph properties (not shown). Other plotting properties, such as the <i>q</i> units (&#8491; or nm), can be set in the <a href=somo_saxs_options.html> SAS Miscellaneous Options</a> submenu. If a csv-style file is chosen, the datasets will be uploaded and listed in a special pop-up panel, where selection and other operations can be performed before plotting (see <a href=somo_saxs_load_csv.html>here</a>). <p>
<li>
<b><i>Load GNOM File</b></i> will allow the uploading of files produced by the GNOM program of the ATSAS suite (Petoukhov et al., J. App. Cryst. 45, 342-350, 2012; see <a href="http://www.embl-hamburg.de/biosaxs/manual_gnom.html">http://www.embl-hamburg.de/biosaxs/manual_gnom.html</a>). This will load graphs in both the <i>I(q)</i> vs. <i>q</i> and <i>P(r)</i> vs. <i>r</i> windows.<br>
Since the <i>P(r)</i> vs. <i>r</i> can be optionally normalized by the ratio between the area under the <i>P(r)</i> curve and the molecular weight of the structure (or bead model), a value for the molecular weight must be entered when loading standard GNOM files. A pop-up window will ask to do so:
<center>
<p>
<img SRC="ift_process_mw.png" ALT="SOMO SAXS GNOM set MW">
</center>
<p>
The user will be then asked if she/he wants to save the entered molecular weight value in the GNOM file:
<center>
<p>
<img SRC="somo-SAXS_SANS_p_r_store_MW_gnom.png" ALT="SOMO SAXS GNOM store MW">
</center>
<p>
If the user accepts to save the molecular weight in the GNOM file, another pop-up window will appear asking to either overwrite the loaded GNOM file, or to change its filename:
<center>
<p>
<img SRC="somo-SAXS_SANS_p_r_store_MW_gnom_overwrite.png" ALT="SOMO SAXS GNOM store MW replace file">
</center>
<p>
By saving the molecular weight value in the GNOM file, <b><i>US-SOMO</i></b> will recognized it the next time the file is opened, without any further need to re-enter it.<p>
<li>
<b><i>Load Plotted</i></b> will instead open a new window allowing several operations to be performed on the data which are currently displayed in the graphics window. This included loading csv-style files, performing fitting operations, IFT processing of multiple <i>I</i>(<i>q</i>) vs. <i>q</i> datasets, and file saving operations (see <a href=somo_saxs_load_csv.html>here</a>).<p>
<li>
<b><i>Set Grid</i></b> will open a dialog box allowing to first chose a dataset taken from any of the plotted curves
<center>
<p>
<img SRC="somo-SAS_set_grid.png" ALT="SOMO SAS set grid">
</center>
<p>
and then to chose the finesse of the grid based on the number ov available <i>q</i> points:
<center>
<p>
<img SRC="somo-SAS_set_grid1.png" ALT="SOMO SAS set grid">
</center>
<p>
For instance, setting a grid is quite useful when computing a SAXS/SANS <i>I(q)</i> vs. <i>q</i> curve from a structure to be compared with experimental data.<p>
<li>
<b><i>Clear SAXS (SANS) Curve</i></b> will instead sequentially remove the data from the graphics window.<p>
<li>
<b><i>Width</i></b> Each time this button is pressed, it increments the data line size of the plots. After five steps, it goes back to the initial value. Data represented as symbols with error bars (see below) are not affected.<p>
<li>
Selecting the <b><i>Err</i></b> checkbox, active when up to 10 files are selected, will switch their representation from the dots connected with a line mode to symbols (diamonds) with their associated SDs represented as error bars mode, as shown in the image below:<p>

<center>
<p>
<img SRC="somo-SAS_Err.png" ALT="SOMO SAS display errors">
</center>
<p>

<li>
<b><i>IFT</i></b> Available from the <span style="color:#CC0000">January 2018 release</span>, it will perform an inverse Fourier transform of the <i>I(q)</i> vs. <i>q</i> data to produce a pair-wise distance distribution curve using the indirect transform method (Glatter, J. Appl. Cryst. 10, 415-421, 1977) as implemented in the Bayesian method described by Hansen (Hansen, J. Appl. Cryst. 33, 1415-1421, 2000) (see <a href=saxs_ift.html>here</a>).<p>
<li>
<b><i>Search</i></b> will open up a dialog box where buffer electron density, excluded volume scaling, and the excluded volume of explict waters can be automatically varied and fit against experimental data (see <a href=somo_SAXS_search.html>here</a>).<p>
<li>
<b><i>Data</i></b> will open a module containing various utilities for primary and processed data treatment, with the ability to perform buffer subtractions, normalization and curve joining (see <a href=somo_saxs_buffer.html>here</a>).<p>
<li>
<b><i>HPLC</i></b> will call an utility dedicated to the advanced processing of HPLC-SAXS data, for instance allowing to plot the scattered intensity at each momentum transfer <i>q</i> as a function of the elution profile, tracing and subtracting baselines, singular value decomposition (SVD), and Gaussian analysis/decomposition of not resolved peaks (see <a href=somo_saxs_hplc.html>here</a>).<p>
<li>
The <b><i>Guinier</i></b> button will allow the manual or semi-automated computation of the global, cross-section (CS, for rod-like molecules), and transverse (TV, for disk-like molecules) <i>z</i>-average square radii of gyration, <i>&lt;R<sub>g</sub><sup>2</sup>&gt;<sub>z</sub></i>, <i>&lt;R<sub>c</sub><sup>2</sup>&gt;<sub>z</sub></i>, and <i>&lt;R<sub>t</sub><sup>2</sup>&gt;<sub>z</sub></i>, respectively, and of the corresponding weight-average intensities at zero scattering angle <i>&lt;I(0)&gt;<sub>w</sub></i> and hence the molecular weight, mass/lengh ratio, and mass/area ratio, <i>&lt;M&gt;<sub>w</sub></i>, <i>&lt;M/L&gt;<sub>w/z</sub></i>, and <i>&lt;M/A&gt;<sub>w/z</sub></i>, respectively, from Guinier plots (Glatter and Kratky, Editors. Small-Angle X-ray Scattering. New York: Academic Press. 1982). On pressing <b><i>Guinier</i></b>, the <b><i>Guinier Options</i></b> panel (see <a href=somo_saxs_options.html>here</a>) will open up and allow modifying the settings, and then the alternative Guinier calculations can be launched from separate buttons. <p>
<li>
<b><i>Legend</i></b> will toggle on and off the names of the files plotted and their associated line colours.<p>
<li>
<b><i>Save plots</i></b>. Finally, the data shown in any of the plots currently visualized can be saved in csv-formatted files by pressing the <b><i>Save plots</i></b> button. This will open a pop-up dialogue window where the location and the root filename for the cvs files can be set.<p>
</ul>
Clicking on the <i>Guinier</i> (and, for rod-like or disk-like macromolecules Guinier analysis, on the <i>CS</i> or <i>TV</i> checkboxes), the Guinier plots, ln[<i>I(q)</i>] vs. <i>q<sup>2</sup></i>, ln[<i>q I(q)</i>] vs. <i>q<sup>2</sup></i> (CS), and ln[<i>q<sup>2</sup>I(q)</i>] vs. <i>q<sup>2</sup></i> (TV), respectively, can be shown, and their display <i>q<sup>2</sup></i> ranges can be modified by entering values in the corresponding fields. <p>

<p>
<center>
<img SRC="somo-SAXS_SANS_Guinier_analysis.png" ALT="SOMO SAXS I(q) Guinier analysis plot"><p>
</center>
<p>
The fit residuals can be shown by selecting the <i>Show residuals</i> checkbox at the bottom of the graph. The residuals can be weighted by the SD associated with the data by selecting the <i>Use standard deviations</i> checkbox. In the example shown above, the outliers rejection routine (see <a href=somo_saxs_options.html>here</a>) was set at 2 SD, resulting in the rejection of the four data points marked with red crosses, better seen in the residuals plot. The residuals can also be shown in % mode by selecting the <i>By percent</i> checkbox. Irrespective of the visualization of the residuals graph, the SD associated with the data can be shown in the Guinier plot by selecting the <i>SD error bars</i> checkbox. <br>
The results of the Guinier analysis are shown in the progress window:
<p>
<center>
<img SRC="somo-SAXS_SANS_Guinier_analysis_report.png" ALT="SOMO SAXS I(q) Guinier analysis report">
</center>
<p>

By selecting the <i>Kratky plot</i> checkbox, it is also possible to plot the data as a Kratky plot (<i>q<sup>2</sup>I(q)</i> vs. <i>q</i>; Glatter and Kratky, Editors. Small-Angle X-ray Scattering. New York: Academic Press. 1982)); the <i>q</i> range can be modified in the corresponding fields. When comparing experimental and calculated data, a fit can be done in either standard or Kratky mode, with or without standard deviation (SD) weighting, by selecting the appropriate options in the Miscellaneous Options panel of the SAS Options menu (see <a href=somo_saxs_options.html>here</a>).<p>
<p>
<center>
<img SRC="somo-SAXS_SANS_Kratky.png" ALT="SOMO SAXS I(q) Kratky plot">
</center>
<p>
Clicking on <i>Standard</i> will revert the plot to the <i>I(q)</i> vs. <i>q</i> mode. 

<hr>
<p>
The method used for the computations of <i>I(q)</i> vs. <i>q</i> from atomic coordinates can be selected in the bar below the <i>Create standard output files</i> checkbox (if this checkbox is left unselected, no output files will be produced).<br>
<b>SAXS</b> or <b>SANS</b> is the first option (default: <b>SAXS</b>; if SANS is selected, the name of the plot in the right-side upper panel will change accordingly). For <b>SAXS</b>, the choice is between:<p>
<ul>
<li>
Full Debye (<b>F-DB</b>)<p>
<li>
Debye with spherical harmonics (<b>SH-DB</b>) <p>
<li>
"Quick" Debye (<b>Q-DB</b>), a fast methods based on FoXS (Schneidman-Duhovny et al., Nucl. Acids Res. 38, W540-W544, 2010, whose original code is available only for Linux-based operating systems) <p>
<li>
<b>Crysol</b> (Svergun et al., J. Appl. Cryst. 28, 768-773, 1995); the executable needs to be downloaded (<a href="http://www.embl-hamburg.de/biosaxs/software.html">http://www.embl-hamburg.de/biosaxs/software.html</a>) and pre-installed in the existing ultrascan/bin program directory. <p>
</ul>
For <b>SANS</b>, only Cryson (Svergun et al., Proc. Natl. Acad. Sci. USA, 95, 2267-2272, 1998), which again needs to be downloaded and pre-installed as above, is currently available; the corresponding SANS implementations of full Debye, Debye with spherical harmonics, and quick Debye will be made available in a future release.<p>
A detailed description of some of the <i>I(q)</i> vs. <i>q</i> calculation methods reported above can be found in the <a href=somo_saxs_options.html> SAXS/SANS Options submenu</a>, where the parameters and options can be set. <p>

When a method is selected, the right field of the <i>File suffix:</i> two fields will show an automatic extension: "db" for Full Debye, "sh" for Debye with spherical harmonics, "qd" for quick Debye,and cr_h##_g##_hs#_## for Crysol. For the latter, h## indicates the number of harmonics, g## the order of the Fibonacci grid, and hs#_## the contrast of the hydration shell. An user defined file suffix can also be added in the left field, and the content of these two fields will be appended to the PDB (or bead model) root filename. The <i>I(q)</i> vs. <i>q</i> curves generated with the F-DB, SH-DB, and Q-DB methods will have the extension ".ssaxs" (or ".ssans"). Curves generated with FoXS will have a ".dat" extension, and those generated with Crysol/Cryson will have the ".int" extension. CHECK HERE<p>

The computation of the <i>I(q)</i> vs. <i>q</i> profile is started by pressing the <b><i>Compute SAXS</i></b> (alternatively, <b><i>Compute SANS</i></b>) button. If one or more curves (experimental or model) are already loaded in the graphics window, a small window will pop-up asking to select the target plotted data to set the <i>I(q)</i> grid defining the starting and ending <i>q</i> values and the stepsize over which the <i>I(q)</i> vs. <i>q</i> computations will be carried out:  
<center>
<p>
<img SRC="somo-SAXS_SANS_setgrid.png" ALT="SOMO SAXS I(q) SAXS computation set grid">
</center>
<p>
Pressing <i>Cancel</i> will set the <i>q</i> range to the one defined in the <a href=somo_saxs_options.html> SAXS/SANS Options submenu</a>. Pressing <i>OK</i>, another small window will pop-up asking to decide to either keep the whole range of <i>q</i> values, or to decimate it by dividing the number of <i>q</i> points by an integer:  
<center>
<p>
<img SRC="somo-SAXS_SANS_setgrid1.png" ALT="SOMO SAXS I(q) SAXS computation set grid-divide">
</center>
<p>
This allows avoiding long computations when the target curve contains a large number of <i>q</i> values. If a number greater than 1 is entered, on pressing <i>OK</i> the same window will report an updated number of grid points, and the operation can be repeated until a satisfactory number of points is attained (be aware that the current version of <b>Crysol</b> provided with <b>US-SOMO</b> will not use more than 200 <i>q</i> points anyway): 
<center>
<p>
<img SRC="somo-SAXS_SANS_setgrid2.png" ALT="SOMO SAXS I(q) SAXS computation set grid-divide2">
</center>
<p>
If the integer has not been changed, on pressing <i>OK</i> the computation of <i>I(q)</i> vs. <i>q</i> is finally launched, and its progress is monitored by the <i>Progress bar</i> right next to the <b><i>Compute SAXS</i></b> button, and in the progress window at the bottom of the panel.<p>
<center>
<p>
<img SRC="somo-SAXS_SANS_cal_progress.png" ALT="SOMO SAXS I(q) SAXS computation progress">
</center>
<p>

At the end of the computation, a small window pops-up asking if the computed curve is to be rescaled on other previously loaded curves. The curve used to set the grid is proposed as the target curve:<p>
<center>
<p>
<img SRC="somo-SAXS_SANS_Scaling_curve.png" ALT="SOMO SAXS I(q) SAXS computation scaling">
</center>
<p>
On pressing <i>OK</i>, a check is performed for the existence of a file with the same filename. If one is found, another windows pops-up:
<center>
<p>
<img SRC="somo-SAXS_SANS_overwrite.png" ALT="SOMO SAXS I(q) SAXS overwrite?">
</center>
<p>
The existing file can be replaced by pressing the <b><i>Overwrite existing file</i></b> button, or the automatically appended number at the end of the original filename (e.g. "1" before "-db" in the above example) can be augmented by one pressing the <b><i>Use next sequential integer</i></b> button. Alternatively, the filename can be modified by writing in the <i>Update the filename</i> field and then pressing the <b><i>Try again</i></b> button (if the new filename exists, the pop-up window will reappear updated).<br>
Once filenames issues have been cleared, the graphics window and the progress window are updated:<p>
<center>
<p>
<img SRC="somo-SAXS_SANS_comp_Plotted1.png" ALT="SOMO SAXS I(q) SAXS Plotted">
</center>
<p>
<center>
<p>
<img SRC="somo-SAXS_SANS_cal_progress1.png" ALT="SOMO SAXS I(q) SAXS Progress final">
</center>
<p>
The progress window reports several parameters of the scaling/matching operation, like fitting range, scaling factor, &chi;<sup>2</sup>, degrees of freedom (df), normalized &chi; (nchi=<span style="white-space: nowrap; font-size:larger"> &radic;</span> <span style="text-decoration:overline;">&nbsp;&chi;<sup><span style="white-space: nowrap; font-size:smaller">2</span></sup>&nbsp; / (df - 1) &nbsp;</span> ), the average fractional standard deviation of the target curve (sdf; this is obtained by first dividing the experimental SD at each <i>q</i> point by the experimental <i>I(q)</i> signal at that point, and then making the average), and the product nchi*sdf. The scaling operation is performed weighting each point in the target curve by its associated error. Since data derived from modern SAS detectors can have very small associated errors, the resulting nchi can assume relatively large values even for quite good fits. The product nchi*sdf should give a better estimate of the goodness of the fit. This can be seen by comparing the different ways the residuals of the scaling operation can be represented in a pop-up window that appears at the end of the process (see below). The progress window also reports the total and unhydrated excluded volumes, and the average electron density of the model, plus that of the hydration shell if explicit water molecules are present.
Note that all fitting is done on the grid of the target curve.  Any computed curves computed with fewer points than the fitting target curve are interpolated using cubic splines to the experimental curve before fitting.
<center>
<p>
<img SRC="somo-SAXS_SANS_residuals1.png" ALT="SOMO SAXS I(q) Computed SAXS residuals 1">
</center>
<p>
In the graph above, the difference between the calculated and the experimental <i>I(q)</i> points divided by the associated experimental SD are plotted as a funtion of <i>q</i>. The two horizontal white lines indicate the +/- 2 SD which is customarily used as limits for a good fit.<p>
Alternatively, the data can be viewed as a % delta [100 * (<i>I(q)<sub>calc</sub> - I(q)<sub>expt</sub>) / I(q)<sub>expt</sub></i>] by clicking on the <i>Plot as percent</i> checkbox:

<p>
<center>
<p>
<img SRC="somo-SAXS_SANS_residuals3a.png" ALT="SOMO SAXS I(q) Computed SAXS residuals 3">
</center>
<p>
Here we have added two horizontal lines indicating 5% limits of the residuals. We think that this way of plotting the residuals better takes into account the wide variation in both intensity and associated SD values along the <i>q</i> range usually accessed in SAXS experiments.<p>

The same residuals can by also plotted using a log scale by clicking on the <i>Plot log</i> checkbox: 
<p>
<center>
<p>
<img SRC="somo-SAXS_SANS_residuals2.png" ALT="SOMO SAXS I(q) Computed SAXS residuals 2">
</center>
<p>
<p>
<hr><hr>
<center>

<p>
<img SRC="somo-SAXS_SANS_Pr_panel_new.png" ALT="SOMO SAXS P(r) Simulation  Panel">
</center>
<p>
In the <b>P(r) vs. r Plotting Functions</b> section, a previously-generated or experimentally-derived <i>P</i>(<i>r</i>) vs. <i>r</i> curve can be uploaded in the graphics window by pressing the <b><i>Load P(r) Distribution</i></b> button, and the graphics window can be cleared by pressing the <b><i>Clear P(r) Distribution</i></b> button.<br>
As for the <b>I(q) vs. q</b> window, <b><i>Load Plotted</i></b> will open up open a new window allowing several operations to be performed on the data which were currently showed in the graphics window (see <a href=somo_saxs_load_csv.html>here</a>), and <b><i>Legend</i></b> will display the names of the files plotted and their associated line colours. Each time <b><i>Width</i></b> is pressed, it increments the data line size of the plots; after five steps, it goes back to the initial value. Starting from the <span style="color:#CC0000">March 2023 release</span>, SD associated with <i>P</i>(<i>r</i>) vs. <i>r</i> data can now be displayed in this module by selecting the <b><i>Err</b></i> checkbox, and they can be used in NNLS fitting operations (see <a href=somo_saxs_load_csv.html>here</a>).<p>
For the P(r) vs. r computation from an atomic-level structure or a bead model, two fields control the <b><i>Bin size (Angstrom)</i></b> and a <b><i>Smoothing</i></b> window (optional), respectively. <p>

The <i>P(r)</i> vs. <i>r</i> function can be computed in either "<b>Raw</b>", "<b>SAXS</b>", or "<b>SANS</b>" modes, as
selected using the checboxes provided. The equation used is:
<p>
<img SRC="somo-SAS_pr_equation.png" ALT="SOMO SAXS P(r) Equation">
<p>
where the <i>b<sub>i</sub></i> and <i>b<sub>j</sub></i> are:<br>
1- set to "1" for the "<b>Raw</b>" computations;<br> 
2- are the number of electrons of the <i>i</i> and <i>j</i> atomic groups for the <b>SAXS</b> computations;<br>
3- are the neutron scattering lengths of the <i>i</i> and <i>j</i> atomic groups at the set D<sub>2</sub>O fraction <i>Y</i> for the <b>SANS</b> computations.<br>

The terms <i>b<sub>0i</sub></i> and <i>b<sub>0j</sub></i> account for the solvent scattering density. For SAXS, <i>b<sub>0i</sub></i> = 10 &times; (<i>r<sub>i</sub></i> / <i>r<sub>wat</sub></i>)<sup>3</sup>, where 10 is the number of electrons in a water molecule, <i>r<sub>i</sub></i> is the radius of the <i>i<sup>th</sup></i> atom (from the <i>somo.atom</i> table) and <i>r<sub>wat</sub></i> is the radius of a bulk water molecule (as set in the <i>SAXS options</i>). The full implementation for SANS in solution is still pending (March 2023). The Kronecker's <i>delta</i> &delta;(<i>r</i> - <i>r<sub>ij</sub></i>) is applied to the distances <i>r<sub>ij</sub></i> between the atom's <i>i</i> and <i>j</i> centers for every bin <i>r</i>. The resolution is controlled by the <b>Bin size (Angstroms):</b> field (default: <b>1 A</b>). For calculations carried on the original PDB structure, the number of electrons are tabulated in the <a href="somo-hybrid.png">hybridization table</a>). For bead models, only the <b>Raw</b> option is currently (March 2023) active. In a future release, when generating a bead model the number of electrons of the atoms "assigned" to the bead will be summed up and written in the bead model file (9<sup>th</sup> column), and could then be used in the <i>P(r)</i> vs. <i>r</i> computations. Similarly, for the <b>SANS</b> computations directly on a PDB structure, the neutron scattering lengths are computed at the set D<sub>2</sub>O fraction <i>Y</i> (<i>b(Y)<sub>i</sub></i> and <i>b(Y)<sub>j</sub></i>, computed as explained <a href=somo_saxs_options.html> here</a>), and only the <b>Raw</b> option is currently (March 2023) active for bead models. In a future release, when generating a bead model the <i>b(0)</i> values and the number of exchangeable H of the atoms "assigned" to each bead will be summed up and written in the bead model file as the 10<sup>th</sup> and 11<sup>th</sup> columns, respectively. The computation of the <i>b(Y)<sub>i</sub></i> and <i>b(Y)<sub>j</sub></i> at the set D<sub>2</sub>O fraction <i>Y</i> could then be carried out for the evaluation of the SANS <i>P(r)</i> vs. <i>r</i> distribution for a bead model.<p>
 
By pressing the <b><i>Compute P(r) distribution</i></b> button a 3-columns file is created, containing the <i>r</i>, the non-normalized <i>P(r)</i>, and the normalized <i>P(r)</i> values, respectively. Normalization is done by first calculating the area under the <i>P(r)</i> curve and then dividing it by the molecular weight of the structure (or bead model). Each <i>P(r)</i> value is then divided by this ratio. The <b>Normalize</b> checkbox will affect which kind is then shown in the graphics window on the right side, which will automatically rescale upon adding a new graph. The files will be saved in the /somo/SAXS/ directory and will have the extension <i>sprr_r</i> for the "Raw" setting, <i>.sprr_x</i> for the SAXS setting, and <i>.sprr_n</i> for the SANS setting. In addition, a suffix containing the bin size used (<i>e.g.</i>, <i>b1</i> for bin size = 1) will be added at the end of the PDB or bead model filename. For the SANS-type files, a suffix recalling the the D<sub>2</sub>O fraction will be also added (<i>e.g.</i>, <i>D05</i> for D<sub>2</sub>O fraction = 0.5). If a file with the same filename already exist, a prompt will appear asking if it should be overwritten or not. In the latter case, the <i>P(r)</i> vs. <i>r</i> distribution will be computed and shown in the graphics window, but not saved to a new file.<p>

<center>
<img SRC="somo-SAXS_SANS_Pr_new.png" ALT="SOMO SAXS P(r)">
</center>
<p>

Each time a <i>P</i>(<i>r</i>) vs. <i>r</i> is computed or loaded, a radius of gyration is computed according to:

<p>
<center>
<img SRC="Rg_from_Pr.png" ALT="SOMO SAXS Rg computation from P(r)">
</center>
<p>

The progress window will report all operations performed:

<p>
<center>
<img SRC="somo-SAXS_SANS_Pr_progress_new.png" ALT="SOMO SAXS P(r)">
</center>
<p>

Before starting a new <i>P</i>(<i>r</i>) vs. <i>r</i> computation, the residues contributing to  particular bin can be identified by selecting the <i>Residue contr. range (Angstrom):</i> checkbox and entering a range (min-max) in the two fields at its right. In this case, when the <i>P(r)</i> vs. <i>r</i> computation is completed, the <b><i>Display</i></b> button becomes available, and pressing it will call <b><i>RasMol</i></b> where the structure will be visualized with the residues contributing to the selected range color-coded from yellow (max contribution) to blue (min contribution). The other residues will be colored gray.<p>

<p>
<center>
<img SRC="somo-SAXS_SANS_Pr_RasMol.png" ALT="SOMO SAXS P(r) RasMol distances">
</center>
<p>

The graphics window will show every new <i>P(r)</i> vs. <i>r</i> curve in a different color, without erasing curves already present. The correspondence between the colors and the files is reported in the progress window, and can be also toggled on and off below the graphics window by pressing the <b><i>Legend</i></b> button.<p>



Progress in the operations is reported in the advancement bar on the side of the  <b><i>Compute P(r) distribution</i></b> button,
and in the progress window below the buttons. <b><i>Stop</i></b> will halt the current operation, and the option panel containing
the settings controlling the operations, such as the D<sub>2</sub>O fraction (see <a href=somo_saxs_options.html> here</a>), can be directly accessed by pressing the <b><i>Open Options Panel</i></b> button.<p>


<p>


<p>
<hr>
<font face="helvetica" size="-1">
www contact: <a href="mailto:brookes@uthscsa.edu">Emre Brookes</a>
</font>
<p>
<font face="helvetica" size="-1">
This document is part of the <i><b>UltraScan</b></i> Software Documentation
distribution. <br><a href=copyright.html>Copyright &copy; notice</a>.<br><br> The latest version of this document can always be found at:
</font>
<p>
<font face="helvetica" size="-1">
<a href="http://somo.aucsolutions.com">http://somo.aucsolutions.com</a>
</font>
<p>
<font face="helvetica" size="-1">
Last modified on March 6, 2023
</font>
</body>
</html>
