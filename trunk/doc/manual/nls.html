<head>
   <title>Nonlinear Least Squares Fitting Controls</title>
   <META HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=iso-8859-1">
   <LINK href="mainstyle.css" rel="styleSheet" type="text/css">
</head>
<body TEXT="#000000" bgcolor="#FFFFFF" LINK="#0000EF" VLINK="#CF30CF" ALINK="#FF0000">
<table border=0 cellpadding=5>
<tr>
<td>
<img src=ultrascan1.png border=0>
</td>
<td align=vcenter>
<h1 align=center><i>Manual</i></h1>
</td>
</tr>
</table>
<hr>
<p>
<H2>Nonlinear Least Squares Fitting Controls:</H2>
<p>
This document discusses how to use the Nonlinear Least Squares fitting
routine included with <b><i>UltraScan</b></i>. Global equilibrium data
analysis, finite element fitting and global extinction profile fitters 
all use this routine, and share this interface.
<p>
<center>
<img src=nls1.png>
</center>
<p>
Depending on which routine invoked the fitter, the interface will have a 
different label:
<p>
<center>
<table border=1 cellspacing=5 cellpadding=5>
<tr>
<td>Finite Element (AD):</td><td><img src=nls2.png></td>
</tr>
<tr>
<td>Global Equilibrium:</td><td><img src=nls3.png></td>
</tr>
<tr>
<td>Global Wavelength Fitter:</td><td><img src=nls4.png></td>
</tr>
</table>
</center>
<p>
<b>Explanation of Fields and Buttons:</b>
<p>
<table cellpadding=5 border=1>
<tr>
	<td rowspan=10>
		<img src=nls5.png>
	</td>
	<td>
		<b>Iteration Number:</b>
	</td>
	<td>
		The program will keep track on each nonlinear least squares iteration
		and list the current iteration here. The program will abort if the
		maximum number of iterations has been reached. The maximum number of
		iterations can be adjusted in the "NLSQ Fit Tuning Controls" (see below).
	</td>
</tr>
<tr>
	<td>
		<b>Variance:</b>
	</td>
	<td>
		This field indicates the variance from the current iteration.
	</td>
</tr>
<tr>
	<td>
		<b>Std. Deviation</b>
	</td>
	<td>
		This field indicates the standard deviation (square-root of the variance)
		for the current iteration.
	</td>
</tr>
<tr>
	<td>
		<b>Improvement:</b>
	</td>
	<td>
		This field indicates the variance improvement between the current and 
		previous iteration.
	</td>
</tr>
<tr>
	<td>
		<b>Function Evaluations</b>
	</td>
	<td>
		Lists the number of times the model/objective function has been evaluated.
	</td>
</tr>
<tr>
	<td>
		<b>Decompositions:</b>
	</td>
	<td>
		The number of Cholesky decompositions of the information matrix.
	</td>
</tr>
<tr>
	<td>
		<b>Current Lambda</b>
	</td>
	<td>
		The value of the current step size/lambda. What lambda represents
		depends on the nonlinear least squares fitting algorithm that was chosen.
	</td>
</tr>
<tr>
	<td>
		<b># of Parameters</b>
	</td>
	<td>
		Number of parameters floated in the fit.
	</td>
</tr>
<tr>
	<td>
		<b># of Datasets in Fit</b>
	</td>
	<td>
		The number of scans or datasets included in the global fit
	</td>
</tr>
<tr>
	<td>
		<b># of Datapoints in Fit</b>
	</td>
	<td>
		The sum of all datapoints in the fit. The number of degrees of freedom 
		in the fit can be calculated by subtracting the number of parameters
		from the number of datapoints in the fit.
	</td>
</tr>
<tr>
	<td rowspan=10>
		<img src=nls6.png>
	</td>
	<td>
		<b>Fit</b>
	</td>
	<td>
		Start fitting and look for a global minimum. This button will be disabled
		during a fit in progress.
	</td>
</tr>
<tr>
	<td>
		<b>Pause</b>
	</td>
	<td>
		Pause an ongoing fit - this button will be disabled while no fit is in
		progress.
	</td>
</tr>
<tr>
	<td>
		<b>Resume</b>
	</td>
	<td>
		Resume a paused fit. This button is disabled at all times, except when
		a fit is paused.
	</td>
</tr>
<tr>
	<td>
		<b>Save Fit</b>
	</td>
	<td>
		Save a memory tate opy of the current fit. The fit can be recalled 
		later and continued at the same point where it was left off. Make sure 
		the fit has converged before saving it. Do not save a paused fit.
	</td>
</tr>
<tr>
	<td>
		<b>View Report</b>
	</td>
	<td>
		View the data analysis report. Formats differ depending on what
		model and experiment is fitted.
	</td>
</tr>
<tr>
	<td>
		<b>Residuals</b>
	</td>
	<td>
		After the fit has converged, you can display <a href=global_equil32.png>
		residuals</a> of the fit by clicking on this button. Some modules show
		both residuals and overlay plots simultaneously (for example, the
      <a href=nls9.png>finite element fitter</a>), and this feature is disabled.
	</td>
</tr>
<tr>
	<td>
		<b>Overlays</b>
	</td>
	<td>
		After the fit has converged, you can display <a href=global_equil33.png>
		overlays</a> of the fit by clicking on this button.  Some modules show
      both residuals and overlay plots simultaneously (for example, the
      <a href=nls9.png>finite element fitter</a>), and this feature is disabled.
	</td>
</tr>
<tr>
	<td>
		<b>Print</b>
	</td>
	<td>
		Print the plot currently in the plot window. Use the <a href=printer_control.html>
		Printer Control</a> module to select print properties, and also which plot to 
		print in case more than one plotwindow are available (for example, in the 
		<a href=nls9.png>finite element fitter</a>, which shows the residuals and overlays
		simultaneously.
	</td>
</tr>
<tr>
	<td>
		<b>Help</b>
	</td>
	<td>
		Open this help window
	</td>
</tr>
<tr>
	<td>
		<b>close</b>
	</td>
	<td>
		Close this program and exit
	</td>
</tr>
<tr>
	<td rowspan=3>
		<img src=nls7.png>
	</td>
	<td>
		<b>Plot all Data</b>
	</td>
	<td>
		Selecting this checkbox will plot all data combined on the same graph.
		While all nonlinear least squares applications provide residuals and
		overlay plots, this selection also affects other plots that may be 
		available depending on the type of data and selected fitting method.
	</td>
</tr>
<tr>
	<td>
		<b>Monitor Fit Graphically</b>
	</td>
	<td>
		When checked, this allows you to watch the progress of the fit
		graphically, either as residuals or as overlays. If unchecked, 
		the plot is only updated once it is converged.
	</td>
</tr>
<tr>
	<td>
		<b>Plot Groups of 5</b>
	</td>
	<td>
		Selecting this checkbox will plot data in <a href=global_equil34.png>
		groups of 5</a> on the same graph.
		While all nonlinear least squares applications provide residuals and
		overlay plots, this selection also affects other plots that may be 
		available depending on the type of data and selected fitting method.
		By clicking on the counter you can select different groups of 5.
	</td>
</tr>
<tr>
	<td rowspan=10>
		<img src=nls8.png>
	</td>
   <td>
		<b>Linear Constraints</b>
   </td>
	<td>
		(not implemented yet)
	</td>
</tr>

<tr>
   <td>
		<b>Autoconverge</b>
   </td>
	<td>
		When enabled, this feature automatically switches between
		Levenberg-Marquardt and the Quasi-Newton method algorithms
		to improve convergence. Particularly for large fits with
		many parameters fits can get stuck in local minima. A
		local minimum in one algorithm is often not a local
		minimum in another, so by trying multiple algorithms,
		it is often possible to improve the fit. When turned off,
		the user can accomplish the same capability by switching
		manually between multiple algorithms until all attempted
		algorithms converge within one iteration.
	</td>
</tr>

<tr>
	<td>
		<b>NLS Algorithm:</b>
	</td>
	<td>
		Select the nonlinear least squares fitting algorithm. Choices are:
		<ul>
		<li>Levenberg Marquardt (best initial convergence properties, when 
		initial guesses are far from the global minimum) 
		<li>Modified Gauss Newton algorithm (best convergence properties
		near the global minimum)
		<li>Hybrid Method (compromise solution between Levenberg Marquardt
		and Gauss Newton - switches from Levenberg Marquardt to  Gauss Newton
		after Lambda has sufficiently decreased.
		<li>Quasi-Newton is a method well suited for refinement of initial
		Levenberg-Marquardt fits, and can be used in combination with 
		Levenberg-Marquardt to optimize a minimization by using each
		interchangingly until both converge after 1 iteration. The Quasi-Newton
		method often can improve on a Levenberg-Marquardt fit.
		</ul>
	</td>
</tr>
<tr>
	<td>
		<b>Lambda Start:</b>
	</td>
	<td>
		Starting value of Lambda. Set to a large number (1x10<sup>7</a>
		if initial iterations collapse.
	</td>
</tr>
<tr>
	<td>
		<b>Lambda Step Size:</b>
	</td>
	<td>
		The stepsize adjustment made to lambda during each iteration.
	</td>
</tr>
<tr>
	<td>
		<b>Maximum Iterations:</b>
	</td>
	<td>
		If this number is reached, the fitting process aborts.
	</td>
</tr>
<tr>
	<td>
		<b>Fit Tolerance:</b>
	</td>
	<td>
		The fit is considered converged when this value is reached, or when
		the variance cannot be decreased any further than this value.
	</td>
</tr>
<tr>
	<td>
		<b>Fitting Progress</b>
	</td>
	<td>
		Attempts to guess the finish of the fitting process by 
		estimating the number of iterations required to reach convergence.
		The estimate is based on the halving of the 
		variance between successive iterations.
	</td>
</tr>
<tr>
	<td>
		<b>Comments</b>
	</td>
	<td>
		Click here to enter comments for your fit. These comments will
		be included in the <a href=html_report.html>html reports</a> that 
		can be generated for various experiments.
	</td>
</tr>
<tr>
	<td>
		<b>Other fields</b>
	</td>
	<td>
		Blank fields are placeholders for supplemental plots available in
		selected fitting methods. These are discussed elsewhere.
	</td>
</tr>
</table>
<p>
<hr>
<font face=helvetica size=-1>
www contact: <a href=mailto:demeler@biochem.uthscsa.edu>Borries Demeler</a>
<p>
This document is part of the <i><b>UltraScan</i></b> Software Documentation
distribution. <br><a href=copyright.html>Copyright &copy; notice</a>.<p> The latest version of this document can always be found at:
<p>
<ol>
<a href=http://www.ultrascan.uthscsa.edu>http://www.ultrascan.uthscsa.edu</a>
</ol>
<p>
Last modified on January 12, 2003.
</body>
</html>
